var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.walletSlice=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _toolkit=require("@reduxjs/toolkit");var _utils=require("./utils");var _actions=require("./actions");var _type=require("./type");var _utils2=require("../../wallet/utils");var initialState={walletAvatar:"master"+(Math.floor(Math.random()*10000)%6+1),walletType:'aelf',walletName:'Wallet 01',userId:'',currentNetwork:'MAIN',chainList:[]};var walletSlice=exports.walletSlice=(0,_toolkit.createSlice)({name:'wallet',initialState:initialState,reducers:{changeNetworkType:function changeNetworkType(state,action){state.currentNetwork=action.payload;}},extraReducers:function extraReducers(builder){builder.addCase(_actions.resetWallet,function(state){return Object.assign({},initialState,{chainInfo:state.chainInfo});}).addCase(_actions.createWalletAction,function(state,action){var _state$walletInfo;if((_state$walletInfo=state.walletInfo)!=null&&_state$walletInfo.AESEncryptMnemonic)throw new Error(_type.WalletError.walletExists);var currentNetwork=action.payload.networkType||state.currentNetwork||initialState.currentNetwork;var caInfo=action.payload.caInfo;if(caInfo&&!(caInfo!=null&&caInfo.originChainId)){caInfo.originChainId=state.originChainId;}state.walletInfo=Object.assign({},action.payload.walletInfo,{caInfo:(0,_defineProperty2.default)({},currentNetwork,caInfo)});}).addCase(_actions.setCAInfo,function(state,action){var _state$walletInfo2,_state$walletInfo3;var _action$payload=action.payload,pin=_action$payload.pin,caInfo=_action$payload.caInfo,chainId=_action$payload.chainId;(0,_utils.checkPassword)((_state$walletInfo2=state.walletInfo)==null?void 0:_state$walletInfo2.AESEncryptMnemonic,pin);var currentNetwork=action.payload.networkType||state.currentNetwork||initialState.currentNetwork;if(!((_state$walletInfo3=state.walletInfo)!=null&&_state$walletInfo3.AESEncryptMnemonic))throw new Error(_type.WalletError.noCreateWallet);state.walletInfo.caInfo[currentNetwork]=Object.assign({},state.walletInfo.caInfo[currentNetwork],(0,_defineProperty2.default)({},chainId,caInfo));}).addCase(_actions.updateCASyncState,function(state,action){var _state$walletInfo4;var _action$payload2=action.payload,chainId=_action$payload2.chainId,networkType=_action$payload2.networkType;var currentNetwork=networkType||state.currentNetwork||initialState.currentNetwork;if(!((_state$walletInfo4=state.walletInfo)!=null&&_state$walletInfo4.AESEncryptMnemonic))throw new Error(_type.WalletError.noCreateWallet);var caInfo=state.walletInfo.caInfo[currentNetwork][chainId];if(!caInfo)throw new Error(_type.WalletError.caAccountNotExists);state.walletInfo.caInfo[currentNetwork][chainId]=Object.assign({},caInfo,{isSync:true});}).addCase(_actions.setManagerInfo,function(state,action){var _state$walletInfo5,_state$walletInfo6,_state$walletInfo$caI;var _action$payload3=action.payload,pin=_action$payload3.pin,managerInfo=_action$payload3.managerInfo;(0,_utils.checkPassword)((_state$walletInfo5=state.walletInfo)==null?void 0:_state$walletInfo5.AESEncryptMnemonic,pin);var currentNetwork=action.payload.networkType||state.currentNetwork||initialState.currentNetwork;if(!((_state$walletInfo6=state.walletInfo)!=null&&_state$walletInfo6.AESEncryptMnemonic))throw new Error(_type.WalletError.noCreateWallet);if((_state$walletInfo$caI=state.walletInfo.caInfo[currentNetwork])!=null&&_state$walletInfo$caI.managerInfo)throw new Error(_type.WalletError.caAccountExists);state.walletInfo.caInfo[currentNetwork]={originChainId:state.originChainId,managerInfo:managerInfo};}).addCase(_actions.changePin,function(state,action){var _state$walletInfo7;var _action$payload4=action.payload,pin=_action$payload4.pin,newPin=_action$payload4.newPin;(0,_utils.checkPassword)((_state$walletInfo7=state.walletInfo)==null?void 0:_state$walletInfo7.AESEncryptMnemonic,pin);if(!state.walletInfo)throw new Error(_type.WalletError.noCreateWallet);state.walletInfo.AESEncryptMnemonic=(0,_utils2.changeEncryptStr)(state.walletInfo.AESEncryptMnemonic,pin,newPin);state.walletInfo.AESEncryptPrivateKey=(0,_utils2.changeEncryptStr)(state.walletInfo.AESEncryptPrivateKey,pin,newPin);}).addCase(_actions.setChainListAction,function(state,action){var _action$payload5=action.payload,chainList=_action$payload5.chainList,networkType=_action$payload5.networkType;if(!state.chainInfo)state.chainInfo=(0,_defineProperty2.default)({},networkType,chainList);state.chainInfo[networkType]=chainList;}).addCase(_actions.setCAInfoType,function(state,action){var _state$walletInfo8,_state$walletInfo9;var _action$payload6=action.payload,pin=_action$payload6.pin,networkType=_action$payload6.networkType,caInfo=_action$payload6.caInfo;var currentNetwork=networkType||state.currentNetwork||initialState.currentNetwork;(0,_utils.checkPassword)((_state$walletInfo8=state.walletInfo)==null?void 0:_state$walletInfo8.AESEncryptMnemonic,pin);if(!((_state$walletInfo9=state.walletInfo)!=null&&_state$walletInfo9.AESEncryptMnemonic))throw new Error(_type.WalletError.noCreateWallet);state.walletInfo.caInfo=Object.assign({},state.walletInfo.caInfo,(0,_defineProperty2.default)({},currentNetwork,caInfo));}).addCase(_actions.getCaHolderInfoAsync.fulfilled,function(state,action){if(action.payload){state.walletName=action.payload.nickName;state.userId=action.payload.userId;}}).addCase(_actions.setWalletNameAction,function(state,action){state.walletName=action.payload;}).addCase(_actions.setOriginChainId,function(state,action){state.originChainId=action.payload;}).addCase(_actions.resetCaInfo,function(state,action){var _state$walletInfo10;if(!((_state$walletInfo10=state.walletInfo)!=null&&_state$walletInfo10.AESEncryptMnemonic))throw new Error(_type.WalletError.noCreateWallet);var caInfo=state.walletInfo.caInfo;if(caInfo!=null&&caInfo[action.payload])delete caInfo[action.payload];state.walletInfo.caInfo=caInfo;});}});