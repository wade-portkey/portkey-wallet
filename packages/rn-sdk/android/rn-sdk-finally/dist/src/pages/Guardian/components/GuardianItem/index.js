var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.AuthTypes=void 0;exports.default=GuardianItem;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _theme=require("../../../../assets/theme");var _GStyles=_interopRequireDefault(require("../../../../assets/theme/GStyles"));var _CommonButton=_interopRequireDefault(require("../../../../components/CommonButton"));var _CommonText=require("../../../../components/CommonText");var _Svg=_interopRequireDefault(require("../../../../components/Svg"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _unit=require("../../../../utils/unit");var _fonts=_interopRequireDefault(require("../../../../assets/theme/fonts"));var _Loading=_interopRequireDefault(require("../../../../components/Loading"));var _CommonToast=_interopRequireDefault(require("../../../../components/CommonToast"));var _utils=require("../../../../packages/utils");var _verifier=require("../../../../packages/types/verifier");var _styles=require("../../../../assets/theme/styles");var _device=require("../../../../packages/utils/mobile/device");var _wallet=require("../../../../packages/types/types-ca/wallet");var _VerifierImage=require("../VerifierImage");var _hooks=require("../../../../packages/hooks");var _api=require("../../../../utils/api");var _guardian=require("../../../../packages/constants/constants-ca/guardian");var _verifier2=require("../../../../packages/constants/constants-ca/verifier");var _constants=require("../../../../global/constants");var _misc=require("../../../../constants/misc");var _jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/pages/Guardian/components/GuardianItem/index.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var AuthTypes=exports.AuthTypes=[_wallet.LoginType.Apple,_wallet.LoginType.Google];var APPROVAL_TO_VERIFICATION_MAP=(0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)((0,_defineProperty2.default)({},_verifier.ApprovalType.addGuardian,_verifier.VerificationType.addGuardianByApprove),_verifier.ApprovalType.editGuardian,_verifier.VerificationType.editGuardian),_verifier.ApprovalType.deleteGuardian,_verifier.VerificationType.deleteGuardian),_verifier.ApprovalType.removeOtherManager,_verifier.VerificationType.removeOtherManager),_verifier.ApprovalType.communityRecovery,_verifier.VerificationType.communityRecovery);function GuardianItemButton(_ref){var guardianItem=_ref.guardianItem,guardiansStatus=_ref.guardiansStatus,setGuardianStatus=_ref.setGuardianStatus,isExpired=_ref.isExpired,approvalType=_ref.approvalType,disabled=_ref.disabled;var itemStatus=(0,_react.useMemo)(function(){return guardiansStatus==null?void 0:guardiansStatus[guardianItem.key];},[guardianItem.key,guardiansStatus]);var _ref2=itemStatus||{},status=_ref2.status,requestCodeResult=_ref2.requestCodeResult;var guardianInfo=(0,_react.useMemo)(function(){return{guardianItem:guardianItem,verificationType:APPROVAL_TO_VERIFICATION_MAP[approvalType]||_verifier.VerificationType.communityRecovery};},[approvalType,guardianItem]);var operationType=(0,_react.useMemo)(function(){return _verifier2.APPROVAL_TO_OPERATION_MAP[approvalType]||_verifier.OperationTypeEnum.unknown;},[approvalType]);var onSetGuardianStatus=(0,_react.useCallback)(function(guardianStatus){setGuardianStatus==null?void 0:setGuardianStatus({key:guardianItem.key,status:guardianStatus});},[guardianItem.key,setGuardianStatus]);var onSendCode=(0,_hooks.useThrottleCallback)((0,_asyncToGenerator2.default)(function*(){try{var _guardianInfo$guardia;_Loading.default.show();var req=yield _api.verification.sendVerificationCode({params:{type:_wallet.LoginType[guardianInfo.guardianItem.guardianType],guardianIdentifier:guardianInfo.guardianItem.guardianAccount,verifierId:(_guardianInfo$guardia=guardianInfo.guardianItem.verifier)==null?void 0:_guardianInfo$guardia.id,chainId:yield _constants.PortkeyConfig.currChainId(),operationType:operationType}});if(req.verifierSessionId){_Loading.default.hide();yield(0,_utils.sleep)(200);onSetGuardianStatus({requestCodeResult:req,status:_verifier.VerifyStatus.Verifying});}else{throw new Error('send fail');}}catch(error){console.log(error,'====error');_CommonToast.default.failError(error);}_Loading.default.hide();}),[guardianInfo,operationType,onSetGuardianStatus]);var onVerifierAuth=(0,_react.useCallback)((0,_asyncToGenerator2.default)(function*(){console.log('bbb');}),[]);var onVerifier=(0,_hooks.useThrottleCallback)((0,_asyncToGenerator2.default)(function*(){switch(guardianItem.guardianType){case _wallet.LoginType.Apple:case _wallet.LoginType.Google:onVerifierAuth();break;default:{break;}}}),[guardianInfo,requestCodeResult,onVerifierAuth]);var buttonProps=(0,_react.useMemo)(function(){if(isExpired&&status!==_verifier.VerifyStatus.Verified){return{disabled:true,type:'clear',title:'Expired',disabledStyle:_styles.BGStyles.transparent,disabledTitleStyle:_styles.FontStyles.font7};}if(status===_verifier.VerifyStatus.Verifying||AuthTypes.includes(guardianItem.guardianType)&&(!status||status===_verifier.VerifyStatus.NotVerified)){return{onPress:onVerifier,title:'Verify'};}if(!status||status===_verifier.VerifyStatus.NotVerified){return{onPress:onSendCode,title:'Send'};}return{title:'Confirmed',type:'clear',disabledTitleStyle:_styles.FontStyles.font10,disabledStyle:styles.confirmedButtonStyle,disabled:true};},[guardianItem.guardianType,isExpired,onSendCode,onVerifier,status]);return _react.default.createElement(_CommonButton.default,(0,_extends2.default)({type:"primary",disabled:disabled,disabledTitleStyle:styles.disabledTitleStyle,disabledStyle:styles.disabledItemStyle},buttonProps,{titleStyle:[styles.titleStyle,_fonts.default.mediumFont,buttonProps.titleStyle],buttonStyle:[styles.buttonStyle,buttonProps.buttonStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:161,columnNumber:5}}));}function GuardianItem(_ref6){var _this=this,_guardianItem$verifie,_guardianItem$verifie2;var guardianItem=_ref6.guardianItem,isButtonHide=_ref6.isButtonHide,renderBtn=_ref6.renderBtn,_ref6$isBorderHide=_ref6.isBorderHide,isBorderHide=_ref6$isBorderHide===void 0?false:_ref6$isBorderHide,guardiansStatus=_ref6.guardiansStatus,setGuardianStatus=_ref6.setGuardianStatus,isExpired=_ref6.isExpired,isSuccess=_ref6.isSuccess,_ref6$approvalType=_ref6.approvalType,approvalType=_ref6$approvalType===void 0?_verifier.ApprovalType.communityRecovery:_ref6$approvalType;var itemStatus=(0,_react.useMemo)(function(){return guardiansStatus==null?void 0:guardiansStatus[guardianItem.key];},[guardianItem.key,guardiansStatus]);var disabled=isSuccess&&(itemStatus==null?void 0:itemStatus.status)!==_verifier.VerifyStatus.Verified;var guardianAccount=(0,_react.useMemo)(function(){if(![_wallet.LoginType.Apple,_wallet.LoginType.Google].includes(guardianItem.guardianType)){return guardianItem.guardianAccount;}if(guardianItem.isPrivate)return _guardian.PRIVATE_GUARDIAN_ACCOUNT;return guardianItem.thirdPartyEmail||'';},[guardianItem]);var renderGuardianAccount=(0,_react.useCallback)(function(){if(!guardianItem.firstName){return _react.default.createElement(_CommonText.TextM,{numberOfLines:[_wallet.LoginType.Apple,_wallet.LoginType.Google].includes(guardianItem.guardianType)?1:2,style:[styles.nameStyle,_GStyles.default.flex1],__self:_this,__source:{fileName:_jsxFileName,lineNumber:198,columnNumber:9}},guardianAccount);}return _react.default.createElement(_reactNative.View,{style:[styles.nameStyle,_GStyles.default.flex1],__self:_this,__source:{fileName:_jsxFileName,lineNumber:206,columnNumber:7}},_react.default.createElement(_CommonText.TextM,{style:styles.firstNameStyle,numberOfLines:1,__self:_this,__source:{fileName:_jsxFileName,lineNumber:207,columnNumber:9}},guardianItem.firstName),_react.default.createElement(_CommonText.TextS,{style:_styles.FontStyles.font3,numberOfLines:1,__self:_this,__source:{fileName:_jsxFileName,lineNumber:210,columnNumber:9}},guardianAccount));},[guardianAccount,guardianItem.firstName,guardianItem.guardianType]);return _react.default.createElement(_reactNative.View,{style:[styles.itemRow,isBorderHide&&styles.itemWithoutBorder,disabled&&styles.disabledStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:218,columnNumber:5}},guardianItem.isLoginAccount&&_react.default.createElement(_reactNative.View,{style:styles.typeTextRow,__self:this,__source:{fileName:_jsxFileName,lineNumber:220,columnNumber:9}},_react.default.createElement(_reactNative.Text,{style:styles.typeText,__self:this,__source:{fileName:_jsxFileName,lineNumber:221,columnNumber:11}},"Login Account")),_react.default.createElement(_reactNative.View,{style:[_GStyles.default.flexRowWrap,_GStyles.default.itemCenter,_GStyles.default.flex1],__self:this,__source:{fileName:_jsxFileName,lineNumber:224,columnNumber:7}},_react.default.createElement(_Svg.default,{iconStyle:styles.loginTypeIcon,icon:_misc.LoginGuardianTypeIcon[guardianItem.guardianType],size:(0,_unit.pTd)(32),__self:this,__source:{fileName:_jsxFileName,lineNumber:225,columnNumber:9}}),_react.default.createElement(_VerifierImage.VerifierImage,{size:(0,_unit.pTd)(32),label:guardianItem==null?void 0:(_guardianItem$verifie=guardianItem.verifier)==null?void 0:_guardianItem$verifie.name,uri:(_guardianItem$verifie2=guardianItem.verifier)==null?void 0:_guardianItem$verifie2.imageUrl,style:styles.iconStyle,__self:this,__source:{fileName:_jsxFileName,lineNumber:226,columnNumber:9}}),renderGuardianAccount()),!isButtonHide&&_react.default.createElement(GuardianItemButton,{disabled:disabled,isExpired:isExpired,guardianItem:guardianItem,guardiansStatus:guardiansStatus,setGuardianStatus:setGuardianStatus,approvalType:approvalType,__self:this,__source:{fileName:_jsxFileName,lineNumber:235,columnNumber:9}}),renderBtn&&renderBtn(guardianItem));}var styles=_reactNative.StyleSheet.create({itemRow:{height:(0,_unit.pTd)(80),marginTop:8,borderBottomWidth:_reactNative.StyleSheet.hairlineWidth,borderBottomColor:_theme.defaultColors.border6,justifyContent:'space-between',flexDirection:'row',alignItems:'center'},itemWithoutBorder:{borderBottomColor:'transparent'},typeText:{color:_theme.defaultColors.font6,fontSize:(0,_unit.pTd)(10),lineHeight:(0,_unit.pTd)(16)},typeTextRow:{left:0,top:0,height:(0,_unit.pTd)(16),position:'absolute',width:'auto',paddingHorizontal:(0,_unit.pTd)(6),backgroundColor:_theme.defaultColors.bg11,borderTopLeftRadius:(0,_unit.pTd)(6),borderBottomRightRadius:(0,_unit.pTd)(6)},iconStyle:{marginLeft:(0,_unit.pTd)(-6)},nameStyle:{marginLeft:(0,_unit.pTd)(12)},firstNameStyle:{marginBottom:(0,_unit.pTd)(2)},buttonStyle:{height:24},titleStyle:{height:_device.isIOS?20:24,fontSize:(0,_unit.pTd)(12),marginTop:4},confirmedButtonStyle:{opacity:1,backgroundColor:'transparent'},verifierStyle:{marginLeft:(0,_unit.pTd)(-6)},disabledStyle:{opacity:0.4},disabledTitleStyle:{opacity:1},disabledItemStyle:{opacity:1},loginTypeIcon:{borderRadius:(0,_unit.pTd)(16)}});