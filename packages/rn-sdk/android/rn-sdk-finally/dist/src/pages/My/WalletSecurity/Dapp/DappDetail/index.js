var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=_interopRequireWildcard(require("react"));var _PageContainer=_interopRequireDefault(require("../../../../../components/PageContainer"));var _reactNative=require("react-native");var _theme=require("../../../../../assets/theme");var _GStyles=_interopRequireDefault(require("../../../../../assets/theme/GStyles"));var _wallet=require("../../../../../packages/hooks/hooks-ca/wallet");var _useRouterParams2=_interopRequireDefault(require("../../../../../packages/hooks/useRouterParams"));var _CommonText=require("../../../../../components/CommonText");var _styles=require("../../../../../assets/theme/styles");var _unit=require("../../../../../utils/unit");var _DappListItem=_interopRequireDefault(require("../components/DappListItem"));var _hooks=require("../../../../../i18n/hooks");var _Svg=_interopRequireDefault(require("../../../../../components/Svg"));var _ActionSheet=_interopRequireDefault(require("../../../../../components/ActionSheet"));var _CommonSwitch=_interopRequireDefault(require("../../../../../components/CommonSwitch"));var _device=require("../../../../../packages/utils/mobile/device");var _hooks2=require("../../../../../packages/hooks");var _actions=require("../../../../../packages/store/store-ca/dapp/actions");var _browser=require("../../../../../packages/utils/dapp/browser");var _RememberMe=require("components/RememberMe");var _dapp=require("../../../../../packages/hooks/hooks-ca/dapp");var _navigationService=_interopRequireDefault(require("utils/navigationService"));var _dapp2=require("../../../../../packages/constants/constants-ca/dapp");var _session=require("../../../../../packages/types/session");var _store=require("hooks/store");var _redux=require("utils/redux");var _session2=require("../../../../../packages/utils/session");var _CommonToast=_interopRequireDefault(require("../../../../../components/CommonToast"));var _discover=require("hooks/discover");var _cms=require("../../../../../packages/hooks/hooks-ca/cms");var _CommonButton=_interopRequireDefault(require("../../../../../components/CommonButton"));var _this=this,_jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/pages/My/WalletSecurity/Dapp/DappDetail/index.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var DappDetail=function DappDetail(){var _dappInfo$sessionInfo2;var _useLanguage=(0,_hooks.useLanguage)(),t=_useLanguage.t;var pin=(0,_store.usePin)();var checkOriginInBlackList=(0,_cms.useCheckSiteIsInBlackList)();var _useRouterParams=(0,_useRouterParams2.default)(),origin=_useRouterParams.origin;var dappInfo=(0,_dapp.useCurrentDappInfo)(origin);var _ref=dappInfo||{},sessionInfo=_ref.sessionInfo;var dispatch=(0,_hooks2.useAppCommonDispatch)();var _useWallet=(0,_wallet.useWallet)(),currentNetwork=_useWallet.currentNetwork;var updateSessionInfo=(0,_dapp.useUpdateSessionInfo)();var discoverJump=(0,_discover.useDiscoverJumpWithNetWork)();var isExpired=(0,_react.useMemo)(function(){if(!sessionInfo)return false;return(0,_session2.hasSessionInfoExpired)(sessionInfo);},[sessionInfo]);var isRememberMe=(0,_react.useMemo)(function(){if(!!(sessionInfo!=null&&sessionInfo.expiredPlan)&&!isExpired)return true;return false;},[isExpired,sessionInfo]);var isInBlackList=(0,_react.useMemo)(function(){return checkOriginInBlackList((dappInfo==null?void 0:dappInfo.origin)||'');},[checkOriginInBlackList,dappInfo==null?void 0:dappInfo.origin]);var showTips=(0,_react.useCallback)(function(){_ActionSheet.default.alert({message:"Once enabled, your session key will automatically approve all requests from this DApp, on this device only. You won't see pop-up notifications asking for your approvals until the session key expires. This feature is automatically off when you disconnect from the DApp or when the session key expires. You can also manually disable it or change the expiration time.",buttons:[{title:'OK',type:'primary'}]});},[]);var showOverlay=(0,_react.useCallback)(function(){var _dappInfo$sessionInfo;(0,_RememberMe.showPeriodOverlay)({value:(dappInfo==null?void 0:(_dappInfo$sessionInfo=dappInfo.sessionInfo)==null?void 0:_dappInfo$sessionInfo.expiredPlan)||_session.SessionExpiredPlan.hour1,onConfirm:function onConfirm(value){if(!pin)return;updateSessionInfo({manager:(0,_redux.getManagerAccount)(pin),origin:(0,_browser.getOrigin)((dappInfo==null?void 0:dappInfo.origin)||''),expiredPlan:value});_CommonToast.default.success('Session Key updated');}});},[dappInfo==null?void 0:dappInfo.origin,dappInfo==null?void 0:(_dappInfo$sessionInfo2=dappInfo.sessionInfo)==null?void 0:_dappInfo$sessionInfo2.expiredPlan,pin,updateSessionInfo]);var switchRememberMe=(0,_react.useCallback)(function(v){if(v){if(!pin)return;updateSessionInfo({manager:(0,_redux.getManagerAccount)(pin),origin:(0,_browser.getOrigin)((dappInfo==null?void 0:dappInfo.origin)||''),expiredPlan:_session.SessionExpiredPlan.hour1});_CommonToast.default.success('Session Key enabled');}else{updateSessionInfo({origin:(0,_browser.getOrigin)((dappInfo==null?void 0:dappInfo.origin)||'')});_CommonToast.default.success('Session Key disabled');}},[dappInfo==null?void 0:dappInfo.origin,pin,updateSessionInfo]);var disconnectDapp=(0,_react.useCallback)(function(){dispatch((0,_actions.removeDapp)({networkType:currentNetwork,origin:(dappInfo==null?void 0:dappInfo.origin)||''}));_navigationService.default.goBack();},[currentNetwork,dispatch,dappInfo]);var onJumpToDapp=(0,_react.useCallback)(function(name,url){discoverJump({item:{name:name,url:url}});},[discoverJump]);return _react.default.createElement(_PageContainer.default,{titleDom:'Dapp Details',safeAreaColor:['blue','gray'],containerStyles:pageStyles.pageWrap,scrollViewProps:{disabled:true},__self:_this,__source:{fileName:_jsxFileName,lineNumber:131,columnNumber:5}},_react.default.createElement(_DappListItem.default,{type:"detail",item:dappInfo,onPress:function onPress(){return onJumpToDapp((dappInfo==null?void 0:dappInfo.name)||'',(dappInfo==null?void 0:dappInfo.origin)||'');},__self:_this,__source:{fileName:_jsxFileName,lineNumber:136,columnNumber:7}}),_react.default.createElement(_reactNative.View,{style:[_GStyles.default.flexRow,_GStyles.default.spaceBetween,_styles.BGStyles.bg1,pageStyles.sectionWrap,pageStyles.section1],__self:_this,__source:{fileName:_jsxFileName,lineNumber:141,columnNumber:7}},_react.default.createElement(_CommonText.TextM,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:142,columnNumber:9}},t('Connected time')),_react.default.createElement(_CommonText.TextM,{style:_styles.FontStyles.font3,__self:_this,__source:{fileName:_jsxFileName,lineNumber:143,columnNumber:9}},(0,_session2.formatTimeToStr)(dappInfo==null?void 0:dappInfo.connectedTime))),!isInBlackList&&_react.default.createElement(_reactNative.View,{style:[_GStyles.default.flexRow,_GStyles.default.spaceBetween,_styles.BGStyles.bg1,pageStyles.sectionWrap,pageStyles.section2],__self:_this,__source:{fileName:_jsxFileName,lineNumber:147,columnNumber:9}},_react.default.createElement(_reactNative.View,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:149,columnNumber:11}},_react.default.createElement(_reactNative.TouchableOpacity,{onPress:showTips,style:[_GStyles.default.flexRow,_GStyles.default.itemCenter],__self:_this,__source:{fileName:_jsxFileName,lineNumber:150,columnNumber:13}},_react.default.createElement(_CommonText.TextM,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:151,columnNumber:15}},t('Remember me')),_react.default.createElement(_Svg.default,{icon:"question-mark",size:(0,_unit.pTd)(16),color:_theme.defaultColors.icon1,iconStyle:pageStyles.rightArrow,__self:_this,__source:{fileName:_jsxFileName,lineNumber:152,columnNumber:15}})),_react.default.createElement(_CommonText.TextS,{style:_styles.FontStyles.font3,__self:_this,__source:{fileName:_jsxFileName,lineNumber:154,columnNumber:13}},t('Skip authentication after enabled'))),_react.default.createElement(_CommonSwitch.default,{value:isRememberMe,onChange:function onChange(){return switchRememberMe(!isRememberMe);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:156,columnNumber:11}})),!isExpired&&!isInBlackList&&isRememberMe&&_react.default.createElement(_reactNative.View,{style:[_GStyles.default.flexRow,_GStyles.default.spaceBetween,_styles.BGStyles.bg1,pageStyles.sectionWrap,pageStyles.section1],__self:_this,__source:{fileName:_jsxFileName,lineNumber:161,columnNumber:9}},_react.default.createElement(_CommonText.TextM,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:163,columnNumber:11}},t('Session key expires in')),_react.default.createElement(_reactNative.TouchableOpacity,{style:[_GStyles.default.flexRow,_GStyles.default.center],onPress:showOverlay,__self:_this,__source:{fileName:_jsxFileName,lineNumber:164,columnNumber:11}},_react.default.createElement(_CommonText.TextM,{style:_styles.FontStyles.font3,__self:_this,__source:{fileName:_jsxFileName,lineNumber:165,columnNumber:13}},_dapp2.SessionKeyMap[(sessionInfo==null?void 0:sessionInfo.expiredPlan)||_session.SessionExpiredPlan.hour1]),_react.default.createElement(_Svg.default,{icon:"right-arrow",size:(0,_unit.pTd)(16),color:_theme.defaultColors.icon1,iconStyle:pageStyles.rightArrow,__self:_this,__source:{fileName:_jsxFileName,lineNumber:168,columnNumber:13}}))),!isExpired&&!isInBlackList&&isRememberMe&&_react.default.createElement(_reactNative.View,{style:[_GStyles.default.flexRow,_GStyles.default.spaceBetween,_styles.BGStyles.bg1,pageStyles.sectionWrap,pageStyles.section1],__self:_this,__source:{fileName:_jsxFileName,lineNumber:174,columnNumber:9}},_react.default.createElement(_CommonText.TextM,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:176,columnNumber:11}},t('Expiration time')),_react.default.createElement(_CommonText.TextM,{style:_styles.FontStyles.font3,__self:_this,__source:{fileName:_jsxFileName,lineNumber:177,columnNumber:11}},(sessionInfo==null?void 0:sessionInfo.expiredPlan)===_session.SessionExpiredPlan.always?'--':(0,_session2.formatTimeToStr)((sessionInfo==null?void 0:sessionInfo.expiredTime)||0))),_react.default.createElement(_reactNative.View,{style:[_GStyles.default.center,_GStyles.default.paddingArg(10,20,18),pageStyles.buttonContainer],__self:_this,__source:{fileName:_jsxFileName,lineNumber:191,columnNumber:7}},_react.default.createElement(_CommonButton.default,{disabledTitleStyle:_styles.FontStyles.font12,titleStyle:_styles.FontStyles.font12,type:"clear",title:"Disconnect",onPress:disconnectDapp,__self:_this,__source:{fileName:_jsxFileName,lineNumber:192,columnNumber:9}})));};var pageStyles=_reactNative.StyleSheet.create({pageWrap:Object.assign({flex:1,backgroundColor:_theme.defaultColors.bg4},_GStyles.default.paddingArg(24,20,18)),tipsWrap:{lineHeight:(0,_unit.pTd)(20)},deleteBtnTitle:{color:_theme.defaultColors.font12},rightArrow:{marginLeft:(0,_unit.pTd)(4)},sectionWrap:{paddingHorizontal:(0,_unit.pTd)(16),borderRadius:(0,_unit.pTd)(6),alignItems:'center',marginBottom:(0,_unit.pTd)(24)},section1:{height:(0,_unit.pTd)(56)},section2:{height:(0,_unit.pTd)(72)},btnWrap:{height:(0,_unit.pTd)(48),width:'100%'},buttonContainer:{width:_device.screenWidth,position:'absolute',bottom:0}});var _default=exports.default=DappDetail;