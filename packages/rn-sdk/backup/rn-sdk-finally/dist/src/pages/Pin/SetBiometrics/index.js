var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=SetBiometrics;exports.touchAuth=touchAuth;var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _react=_interopRequireWildcard(require("react"));var _CommonText=require("../../../components/CommonText");var _PageContainer=_interopRequireDefault(require("../../../components/PageContainer"));var _CommonButton=_interopRequireDefault(require("../../../components/CommonButton"));var _reactNative=require("react-native");var _GStyles=_interopRequireDefault(require("../../../assets/theme/GStyles"));var _theme=require("../../../assets/theme");var _styles=require("../../../assets/theme/styles");var _Touchable=_interopRequireDefault(require("../../../components/Touchable"));var _mobile=require("../../../packages/hooks/mobile");var _unit=require("../../../utils/unit");var _utils=require("../../../packages/utils");var _CommonToast=_interopRequireDefault(require("../../../components/CommonToast"));var _useEffectOnce=_interopRequireDefault(require("../../../hooks/useEffectOnce"));var _core=require("../../../model/verify/core");var _Loading=_interopRequireDefault(require("../../../components/Loading"));var _entries=require("../../../config/entries");var _UseBaseContainer=_interopRequireDefault(require("../../../model/container/UseBaseContainer"));var _expoLocalAuthentication=require("expo-local-authentication");var _device=require("../../../packages/utils/mobile/device");var _jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/pages/Pin/SetBiometrics/index.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var ScrollViewProps={disabled:true};function touchAuth(){return _touchAuth.apply(this,arguments);}function _touchAuth(){_touchAuth=(0,_asyncToGenerator2.default)(function*(){var options={hintMessage:'Verify your identity',fallbackLabel:'Use password',promptMessage:'AELF identity authentication'};return yield(0,_expoLocalAuthentication.authenticateAsync)(options);});return _touchAuth.apply(this,arguments);}function SetBiometrics(_ref){var pin=_ref.pin,deliveredSetPinInfo=_ref.deliveredSetPinInfo;(0,_mobile.usePreventHardwareBack)();var _useState=(0,_react.useState)(),_useState2=(0,_slicedToArray2.default)(_useState,2),errorMessage=_useState2[0],setErrorMessage=_useState2[1];var _useBaseContainer=(0,_UseBaseContainer.default)({entryName:_entries.PortkeyEntries.SET_BIO}),onFinish=_useBaseContainer.onFinish;var getResult=(0,_react.useCallback)((0,_asyncToGenerator2.default)(function*(){var useBiometrics=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_Loading.default.show();var res=yield(0,_core.getVerifiedAndLockWallet)(deliveredSetPinInfo,pin,useBiometrics);_Loading.default.hide();if(res){onFinish({status:'success',data:{finished:true}});}else{setErrorMessage('network failure');}}),[deliveredSetPinInfo,onFinish,pin]);var openBiometrics=function(){var _ref3=(0,_asyncToGenerator2.default)(function*(){if(!pin){return;}try{var res=yield touchAuth();if(!(res!=null&&res.success)){_CommonToast.default.failError('Failed To Verify');return;}yield getResult(true);onFinish({status:'success',data:{finished:true}});}catch(error){_Loading.default.hide();setErrorMessage((0,_utils.handleErrorMessage)(error,'Failed To Verify'));}});return function openBiometrics(){return _ref3.apply(this,arguments);};}();var onSkip=function(){var _ref4=(0,_asyncToGenerator2.default)(function*(){try{yield getResult();onFinish({status:'success',data:{finished:true}});}catch(error){_Loading.default.hide();_CommonToast.default.failError(error);}});return function onSkip(){return _ref4.apply(this,arguments);};}();(0,_useEffectOnce.default)(function(){setTimeout(function(){openBiometrics();},100);});var biometricIcon=(0,_react.useMemo)(function(){if(_device.isIOS){return{uri:'biometric'};}else{return require("../../../assets/image/pngs/biometric.png");}},[]);return _react.default.createElement(_PageContainer.default,{scrollViewProps:ScrollViewProps,leftDom:true,titleDom:true,containerStyles:styles.containerStyles,__self:this,__source:{fileName:_jsxFileName,lineNumber:110,columnNumber:5}},_react.default.createElement(_Touchable.default,{style:_GStyles.default.itemCenter,onPress:openBiometrics,__self:this,__source:{fileName:_jsxFileName,lineNumber:111,columnNumber:7}},_react.default.createElement(_reactNative.Image,{resizeMode:"contain",source:biometricIcon,style:styles.biometricIcon,__self:this,__source:{fileName:_jsxFileName,lineNumber:112,columnNumber:9}}),_react.default.createElement(_CommonText.TextL,{style:styles.tipText,__self:this,__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:9}},"Enable biometric authentication"),errorMessage?_react.default.createElement(_CommonText.TextS,{style:styles.errorText,__self:this,__source:{fileName:_jsxFileName,lineNumber:114,columnNumber:25}},errorMessage):null),_react.default.createElement(_CommonButton.default,{type:"clear",title:"Skip",buttonStyle:_styles.BGStyles.transparent,onPress:onSkip,__self:this,__source:{fileName:_jsxFileName,lineNumber:116,columnNumber:7}}));}var styles=_reactNative.StyleSheet.create({containerStyles:{justifyContent:'space-around',paddingBottom:52,paddingTop:'25%',alignItems:'center',flex:1},tipText:{marginTop:16},errorText:{marginTop:16,color:_theme.defaultColors.error},biometricIcon:{width:(0,_unit.pTd)(124),height:(0,_unit.pTd)(124)}});