var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.styles=exports.showTokenList=exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _OverlayModal=_interopRequireDefault(require("../OverlayModal"));var _reactNative=require("react-native");var _ModalBody=require("../ModalBody");var _CommonInput=_interopRequireDefault(require("../CommonInput"));var _TokenListItem=_interopRequireDefault(require("../TokenListItem"));var _theme=require("../../assets/theme");var _fonts=_interopRequireDefault(require("../../assets/theme/fonts"));var _unit=require("../../utils/unit");var _hooks=require("../../i18n/hooks");var _useDebounce=_interopRequireDefault(require("../../hooks/useDebounce"));var _NoData=_interopRequireDefault(require("../NoData"));var _useGStyles=require("../../assets/theme/useGStyles");var _deviceEvent=_interopRequireDefault(require("../../utils/deviceEvent"));var _chain=require("../../model/chain");var _hooks2=require("./hooks");var _controller=require("../../network/controller");var _Loading=_interopRequireDefault(require("../Loading"));var _wallet=require("../../model/wallet");var _useEffectOnce=_interopRequireDefault(require("../../hooks/useEffectOnce"));var _this=this,_jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/components/TokenOverlay/index.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var TokenList=function TokenList(_ref){var onFinishSelectToken=_ref.onFinishSelectToken;var _useLanguage=(0,_hooks.useLanguage)(),t=_useLanguage.t;var commonInfo=(0,_hooks2.useCommonNetworkInfo)();var chainIdList=(0,_react.useRef)(undefined);var _useState=(0,_react.useState)(),_useState2=(0,_slicedToArray2.default)(_useState,2),tokenDataShowInMarket=_useState2[0],setTokenDataShowInMarket=_useState2[1];var gStyles=_useGStyles.useGStyles;var _useState3=(0,_react.useState)(null),_useState4=(0,_slicedToArray2.default)(_useState3,2),wallet=_useState4[0],setWallet=_useState4[1];(0,_useEffectOnce.default)((0,_asyncToGenerator2.default)(function*(){setWallet(yield(0,_wallet.getUnlockedWallet)({getMultiCaAddresses:true}));}));var _useState5=(0,_react.useState)(''),_useState6=(0,_slicedToArray2.default)(_useState5,2),keyword=_useState6[0],setKeyword=_useState6[1];var debounceKeyword=(0,_useDebounce.default)(keyword,800);var renderItem=(0,_react.useCallback)(function(_ref3){var item=_ref3.item;return _react.default.createElement(_TokenListItem.default,{noBalanceShow:true,key:""+item.symbol+item.chainId,item:item,onPress:(0,_asyncToGenerator2.default)(function*(){if(!wallet){throw new Error('wallet is not ready');}var multiCaAddresses=wallet.multiCaAddresses;_OverlayModal.default.hide();console.log('select token',item);var chainId=item.token.chainId;var caAddress=multiCaAddresses[chainId];item.currentNetwork=commonInfo.currentNetwork;item.currentCaAddress=caAddress;item.defaultToken=commonInfo.defaultToken;onFinishSelectToken==null?void 0:onFinishSelectToken(item);}),commonInfo:commonInfo,__self:_this,__source:{fileName:_jsxFileName,lineNumber:49,columnNumber:7}});},[commonInfo,wallet,onFinishSelectToken]);(0,_react.useEffect)(function(){_Loading.default.show();function fetchData(){return _fetchData.apply(this,arguments);}function _fetchData(){_fetchData=(0,_asyncToGenerator2.default)(function*(){var _chainIdList$current;if(chainIdList.current===undefined){var chainInfo=yield(0,_chain.getCachedAllChainInfo)();chainIdList.current=chainInfo.map(function(chainInfoItem){return chainInfoItem.chainId;});}var tokenAssets=yield _controller.NetworkController.searchTokenList({chainIdArray:(_chainIdList$current=chainIdList.current)!=null?_chainIdList$current:'AELF',keyword:debounceKeyword});return tokenAssets==null?void 0:tokenAssets.items;});return _fetchData.apply(this,arguments);}fetchData().then(function(result){result&&setTokenDataShowInMarket(result);}).finally(function(){_Loading.default.hide();});},[debounceKeyword]);var noData=(0,_react.useMemo)(function(){return debounceKeyword?_react.default.createElement(_NoData.default,{noPic:true,message:t('There is no search result.'),__self:_this,__source:{fileName:_jsxFileName,lineNumber:98,columnNumber:30}}):null;},[debounceKeyword,t]);return _react.default.createElement(_ModalBody.ModalBody,{modalBodyType:"bottom",title:t('Select Token'),style:gStyles.overlayStyle,__self:_this,__source:{fileName:_jsxFileName,lineNumber:102,columnNumber:5}},_react.default.createElement(_CommonInput.default,{placeholder:t('Token Name'),containerStyle:styles.containerStyle,inputContainerStyle:styles.inputContainerStyle,inputStyle:styles.inputStyle,value:keyword,onChangeText:function onChangeText(v){setKeyword(v.trim());},__self:_this,__source:{fileName:_jsxFileName,lineNumber:103,columnNumber:7}}),_react.default.createElement(_reactNative.FlatList,{onLayout:function onLayout(e){_deviceEvent.default.nestScrollViewLayout.emit(e.nativeEvent.layout);},disableScrollViewPanResponder:true,style:styles.flatList,onScroll:function onScroll(_ref5){var nativeEvent=_ref5.nativeEvent;var scrollY=nativeEvent.contentOffset.y;if(scrollY<=0){_deviceEvent.default.nestScrollViewScrolledTop.emit();}},data:tokenDataShowInMarket||[],renderItem:renderItem,ListEmptyComponent:noData,keyExtractor:function keyExtractor(item){return item.id||'';},__self:_this,__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:7}}));};var showTokenList=exports.showTokenList=function showTokenList(props){_OverlayModal.default.show(_react.default.createElement(TokenList,(0,_extends2.default)({},props,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:137,columnNumber:21}})),{position:'bottom',enabledNestScrollView:true});};var _default=exports.default={showTokenList:showTokenList};var styles=exports.styles=_reactNative.StyleSheet.create({title:Object.assign({textAlign:'center',color:_theme.defaultColors.font5,height:(0,_unit.pTd)(22),lineHeight:(0,_unit.pTd)(22),marginTop:(0,_unit.pTd)(17),marginBottom:(0,_unit.pTd)(16)},_fonts.default.mediumFont),containerStyle:{marginLeft:(0,_unit.pTd)(16),width:(0,_unit.pTd)(343),marginBottom:(0,_unit.pTd)(8)},inputContainerStyle:{height:(0,_unit.pTd)(44)},inputStyle:{height:(0,_unit.pTd)(44)},flatList:{marginTop:(0,_unit.pTd)(8)}});