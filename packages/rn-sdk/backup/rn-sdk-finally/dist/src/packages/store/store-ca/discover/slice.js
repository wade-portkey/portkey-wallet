var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.updateTab=exports.upDateRecordsItem=exports.setActiveTab=exports.resetDiscover=exports.removeRecordsItems=exports.removeAutoApproveItem=exports.initNetworkDiscoverMap=exports.discoverSlice=exports.default=exports.createNewTab=exports.closeExistingTab=exports.closeAllTabs=exports.clearRecordsList=exports.cleanBookmarkList=exports.changeDrawerOpenStatus=exports.addUrlToWhiteList=exports.addRecordsItem=exports.addBookmarkList=exports.addAutoApproveItem=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _toolkit=require("@reduxjs/toolkit");var _immer=require("immer");var _discover=require("../../../constants/constants-ca/discover");(0,_immer.enableMapSet)();var initNetworkData={recordsList:[],whiteList:[],tabs:[],bookmarkList:[]};var initialState={isDrawerOpen:false,discoverMap:{},activeTabId:undefined,initializedList:new Set()};var discoverSlice=exports.discoverSlice=(0,_toolkit.createSlice)({name:'discover',initialState:initialState,reducers:{initNetworkDiscoverMap:function initNetworkDiscoverMap(state,_ref){var payload=_ref.payload;state.discoverMap=Object.assign({},state.discoverMap||{},(0,_defineProperty2.default)({},payload,JSON.parse(JSON.stringify(initNetworkData))));},addUrlToWhiteList:function addUrlToWhiteList(state,_ref2){var _state$discoverMap,_state$discoverMap$pa;var payload=_ref2.payload;(_state$discoverMap=state.discoverMap)==null?void 0:(_state$discoverMap$pa=_state$discoverMap[payload.networkType])==null?void 0:_state$discoverMap$pa.whiteList.push(payload.url);},addRecordsItem:function addRecordsItem(state,_ref3){var _state$discoverMap2,_state$discoverMap3,_state$discoverMap3$n,_state$discoverMap3$n2,_state$discoverMap4;var payload=_ref3.payload;var networkType=payload.networkType,url=payload.url;if(!(state!=null&&state.discoverMap))state.discoverMap={};if(!(state!=null&&(_state$discoverMap2=state.discoverMap)!=null&&_state$discoverMap2[networkType]))state.discoverMap[networkType]=initNetworkData;var targetItem=(_state$discoverMap3=state.discoverMap)==null?void 0:(_state$discoverMap3$n=_state$discoverMap3[networkType])==null?void 0:(_state$discoverMap3$n2=_state$discoverMap3$n.recordsList)==null?void 0:_state$discoverMap3$n2.find(function(item){return item.url===url;});var targetNetworkDiscover=(state==null?void 0:(_state$discoverMap4=state.discoverMap)==null?void 0:_state$discoverMap4[networkType])||{};if(_discover.RECORD_LIMIT<=(targetNetworkDiscover==null?void 0:targetNetworkDiscover.recordsList.length)){targetNetworkDiscover==null?void 0:targetNetworkDiscover.recordsList.shift();}if(targetItem){var _state$discoverMap5,_state$discoverMap5$n,_state$discoverMap5$n2;var arr=((_state$discoverMap5=state.discoverMap)==null?void 0:(_state$discoverMap5$n=_state$discoverMap5[networkType])==null?void 0:(_state$discoverMap5$n2=_state$discoverMap5$n.recordsList)==null?void 0:_state$discoverMap5$n2.filter(function(item){return item.url!==url;}))||[];arr.push(targetItem);targetNetworkDiscover.recordsList=arr;}else{targetNetworkDiscover.recordsList.push(Object.assign({},payload));}},upDateRecordsItem:function upDateRecordsItem(state,_ref4){var _state$discoverMap6,_targetNetworkDiscove;var payload=_ref4.payload;var networkType=payload.networkType;var targetNetworkDiscover=((_state$discoverMap6=state.discoverMap)==null?void 0:_state$discoverMap6[networkType])||{};targetNetworkDiscover.recordsList=targetNetworkDiscover==null?void 0:(_targetNetworkDiscove=targetNetworkDiscover.recordsList)==null?void 0:_targetNetworkDiscove.map(function(item){return item.url===payload.url?Object.assign({},item,payload):item;});},removeRecordsItems:function removeRecordsItems(state,_ref5){var _state$discoverMap7,_targetNetworkDiscove2;var payload=_ref5.payload;var networkType=payload.networkType,_payload$ids=payload.ids,ids=_payload$ids===void 0?[]:_payload$ids;var targetNetworkDiscover=((_state$discoverMap7=state.discoverMap)==null?void 0:_state$discoverMap7[networkType])||{};var idsObj={};ids.forEach(function(id){idsObj[id]=id;});targetNetworkDiscover.recordsList=targetNetworkDiscover==null?void 0:(_targetNetworkDiscove2=targetNetworkDiscover.recordsList)==null?void 0:_targetNetworkDiscove2.filter(function(ele){return!(idsObj!=null&&idsObj[ele==null?void 0:ele.id]);});},clearRecordsList:function clearRecordsList(state,_ref6){var _state$discoverMap8;var payload=_ref6.payload;var networkType=payload.networkType;var targetNetworkDiscover=((_state$discoverMap8=state.discoverMap)==null?void 0:_state$discoverMap8[networkType])||{};targetNetworkDiscover.recordsList=[];},closeAllTabs:function closeAllTabs(state,_ref7){var _state$discoverMap9;var payload=_ref7.payload;var networkType=payload.networkType;var targetNetworkDiscover=((_state$discoverMap9=state.discoverMap)==null?void 0:_state$discoverMap9[networkType])||{};targetNetworkDiscover.tabs=[];state.activeTabId=undefined;},createNewTab:function createNewTab(state,_ref8){var _state$discoverMap10;var payload=_ref8.payload;var networkType=payload.networkType,id=payload.id;var targetNetworkDiscover=((_state$discoverMap10=state.discoverMap)==null?void 0:_state$discoverMap10[networkType])||{};if(!(targetNetworkDiscover!=null&&targetNetworkDiscover.tabs)){targetNetworkDiscover.tabs=[Object.assign({},payload)];}else{var _targetNetworkDiscove4;if(_discover.TAB_LIMIT<=targetNetworkDiscover.tabs.length){var _targetNetworkDiscove3;targetNetworkDiscover==null?void 0:(_targetNetworkDiscove3=targetNetworkDiscover.tabs)==null?void 0:_targetNetworkDiscove3.shift();}targetNetworkDiscover==null?void 0:(_targetNetworkDiscove4=targetNetworkDiscover.tabs)==null?void 0:_targetNetworkDiscove4.push(Object.assign({},payload));}state.activeTabId=id;},closeExistingTab:function closeExistingTab(state,_ref9){var _state$discoverMap11,_targetNetworkDiscove5;var payload=_ref9.payload;var networkType=payload.networkType,id=payload.id;var targetNetworkDiscover=((_state$discoverMap11=state.discoverMap)==null?void 0:_state$discoverMap11[networkType])||{};targetNetworkDiscover.tabs=targetNetworkDiscover==null?void 0:(_targetNetworkDiscove5=targetNetworkDiscover.tabs)==null?void 0:_targetNetworkDiscove5.filter(function(item){return item.id!==id;});},setActiveTab:function setActiveTab(state,_ref10){var payload=_ref10.payload;var id=payload.id;if(!state.initializedList)state.initializedList=new Set();id&&state.initializedList.add(id);state.activeTabId=id;},updateTab:function updateTab(state,_ref11){var _state$discoverMap12,_targetNetworkDiscove6;var payload=_ref11.payload;var networkType=payload.networkType,id=payload.id;var targetNetworkDiscover=((_state$discoverMap12=state.discoverMap)==null?void 0:_state$discoverMap12[networkType])||{};targetNetworkDiscover.tabs=targetNetworkDiscover==null?void 0:(_targetNetworkDiscove6=targetNetworkDiscover.tabs)==null?void 0:_targetNetworkDiscove6.map(function(item){return item.id===id?Object.assign({},item,payload):item;});},changeDrawerOpenStatus:function changeDrawerOpenStatus(state,_ref12){var payload=_ref12.payload;state.isDrawerOpen=payload;},resetDiscover:function resetDiscover(state,_ref13){var payload=_ref13.payload;state.discoverMap=Object.assign({},state.discoverMap||{},(0,_defineProperty2.default)({},payload,JSON.parse(JSON.stringify(initNetworkData))));},cleanBookmarkList:function cleanBookmarkList(state,_ref14){var _state$discoverMap13;var payload=_ref14.payload;state.discoverMap=Object.assign({},state.discoverMap||{},(0,_defineProperty2.default)({},payload,Object.assign({},((_state$discoverMap13=state.discoverMap)==null?void 0:_state$discoverMap13[payload])||{},{bookmarkList:[]})));},addBookmarkList:function addBookmarkList(state,_ref15){var _state$discoverMap14,_state$discoverMap14$,_state$discoverMap15;var payload=_ref15.payload;var preBookmarkList=((_state$discoverMap14=state.discoverMap)==null?void 0:(_state$discoverMap14$=_state$discoverMap14[payload.networkType])==null?void 0:_state$discoverMap14$.bookmarkList)||[];state.discoverMap=Object.assign({},state.discoverMap||{},(0,_defineProperty2.default)({},payload.networkType,Object.assign({},((_state$discoverMap15=state.discoverMap)==null?void 0:_state$discoverMap15[payload.networkType])||{},{bookmarkList:preBookmarkList.concat(payload.list)})));},addAutoApproveItem:function addAutoApproveItem(state,_ref16){var payload=_ref16.payload;if(!state.autoApproveMap)state.autoApproveMap={};state.autoApproveMap=Object.assign({},state.autoApproveMap,(0,_defineProperty2.default)({},payload,true));},removeAutoApproveItem:function removeAutoApproveItem(state,_ref17){var payload=_ref17.payload;if(!state.autoApproveMap)state.autoApproveMap={};if(state.autoApproveMap[payload])delete state.autoApproveMap[payload];}}});var _discoverSlice$action=discoverSlice.actions,initNetworkDiscoverMap=exports.initNetworkDiscoverMap=_discoverSlice$action.initNetworkDiscoverMap,addUrlToWhiteList=exports.addUrlToWhiteList=_discoverSlice$action.addUrlToWhiteList,addRecordsItem=exports.addRecordsItem=_discoverSlice$action.addRecordsItem,upDateRecordsItem=exports.upDateRecordsItem=_discoverSlice$action.upDateRecordsItem,removeRecordsItems=exports.removeRecordsItems=_discoverSlice$action.removeRecordsItems,clearRecordsList=exports.clearRecordsList=_discoverSlice$action.clearRecordsList,resetDiscover=exports.resetDiscover=_discoverSlice$action.resetDiscover,closeAllTabs=exports.closeAllTabs=_discoverSlice$action.closeAllTabs,createNewTab=exports.createNewTab=_discoverSlice$action.createNewTab,closeExistingTab=exports.closeExistingTab=_discoverSlice$action.closeExistingTab,setActiveTab=exports.setActiveTab=_discoverSlice$action.setActiveTab,updateTab=exports.updateTab=_discoverSlice$action.updateTab,changeDrawerOpenStatus=exports.changeDrawerOpenStatus=_discoverSlice$action.changeDrawerOpenStatus,cleanBookmarkList=exports.cleanBookmarkList=_discoverSlice$action.cleanBookmarkList,addBookmarkList=exports.addBookmarkList=_discoverSlice$action.addBookmarkList,addAutoApproveItem=exports.addAutoApproveItem=_discoverSlice$action.addAutoApproveItem,removeAutoApproveItem=exports.removeAutoApproveItem=_discoverSlice$action.removeAutoApproveItem;var _default=exports.default=discoverSlice;