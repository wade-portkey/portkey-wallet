var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.getAddressInfo=exports.encodedTx=void 0;exports.getAelfAddress=getAelfAddress;exports.getELFContract=exports.getChainNumber=exports.getAelfInstance=void 0;exports.getEntireDIDAelfAddress=getEntireDIDAelfAddress;exports.getWallet=getWallet;exports.isAelfAddress=isAelfAddress;exports.isAllowAelfAddress=isAllowAelfAddress;exports.isCrossChain=void 0;exports.isDIDAelfAddress=isDIDAelfAddress;exports.isEqAddress=isEqAddress;exports.transformArrayToMap=transformArrayToMap;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _aelfSdk=_interopRequireDefault(require("aelf-sdk"));var _constants=require("../constants");var _reg=require("./reg");var Wallet=_aelfSdk.default.wallet;function isEqAddress(a1,a2){return(a1==null?void 0:a1.toLocaleLowerCase())===(a2==null?void 0:a2.toLocaleLowerCase());}function isAelfAddress(value){if(!value||!(0,_reg.isValidBase58)(value))return false;if(value.includes('_')&&value.split('_').length<3)return false;try{return!!_aelfSdk.default.utils.decodeAddressRep(value);}catch(_unused){return false;}}var getChainNumber=exports.getChainNumber=function getChainNumber(chainId){return _aelfSdk.default.utils.chainIdConvertor.base58ToChainId(chainId);};function isDIDAelfAddress(value){if(!value||!(0,_reg.isValidBase58)(value))return false;if(value.includes('_')&&value.split('_').length===2){var arr=value.split('_');var res=arr[0].length>arr[1].length?arr[0]:arr[1];try{return!!_aelfSdk.default.utils.decodeAddressRep(res);}catch(_unused2){return false;}}try{return!!_aelfSdk.default.utils.decodeAddressRep(value);}catch(_unused3){return false;}}var initAddressInfo={prefix:'',address:'',suffix:''};var getAddressInfo=exports.getAddressInfo=function getAddressInfo(value){var arr=value.split('_');if(arr.length>3||arr.length===0)return initAddressInfo;if(arr.length===3)return{prefix:arr[0],address:arr[1],suffix:arr[2]};if(arr.length===1)return Object.assign({},initAddressInfo,{address:value});if(isAelfAddress(arr[0]))return Object.assign({},initAddressInfo,{address:arr[0],suffix:arr[1]});return Object.assign({},initAddressInfo,{prefix:arr[0],address:arr[1]});};function getEntireDIDAelfAddress(value){var defaultPrefix=arguments.length>1&&arguments[1]!==undefined?arguments[1]:'ELF';var defaultSuffix=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'AELF';var arr=value.split('_');if(arr.length>3||arr.length===0)return'';if(arr.length===3)return value;if(arr.length===1)return defaultPrefix+"_"+value+"_"+defaultSuffix;if(isAelfAddress(arr[0]))return defaultPrefix+"_"+value;return value+"_"+defaultSuffix;}function isAllowAelfAddress(value){var arr=value.split('_');if(arr.length>3||arr.length===0)return false;if(arr.length===3||arr.length===1)return isAelfAddress(value);for(var i=0;i<arr.length;i++){if(isAelfAddress(arr[i]))return true;}return false;}function getAelfAddress(){var value=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var arr=value.split('_');if(arr.length===3)return arr[1];for(var i=0;i<arr.length;i++){if(isAelfAddress(arr[i]))return arr[i];}return value;}function getWallet(){var privateKey=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_constants.COMMON_PRIVATE;return Wallet.getWalletByPrivateKey(privateKey);}var getAelfInstance=exports.getAelfInstance=function getAelfInstance(rpcUrl){return new _aelfSdk.default(new _aelfSdk.default.providers.HttpProvider(rpcUrl,20000));};var getELFContract=exports.getELFContract=function(){var _ref=(0,_asyncToGenerator2.default)(function*(rpcUrl,tokenAddress,privateKey){var aelf=getAelfInstance(rpcUrl);var wallet=privateKey?Wallet.getWalletByPrivateKey(privateKey):getWallet();return yield aelf.chain.contractAt(tokenAddress,wallet);});return function getELFContract(_x,_x2,_x3){return _ref.apply(this,arguments);};}();var isWrappedBytes=function isWrappedBytes(resolvedType,name){if(!(resolvedType!=null&&resolvedType.name)||(resolvedType==null?void 0:resolvedType.name)!==name){return false;}if(!(resolvedType!=null&&resolvedType.fieldsArray)||(resolvedType==null?void 0:resolvedType.fieldsArray.length)!==1){return false;}return(resolvedType==null?void 0:resolvedType.fieldsArray[0].type)==='bytes';};var isAddress=function isAddress(resolvedType){return isWrappedBytes(resolvedType,'Address');};var isHash=function isHash(resolvedType){return isWrappedBytes(resolvedType,'Hash');};function transformArrayToMap(inputType,origin){if(!origin)return'';if(!Array.isArray(origin))return origin;if(origin.length===0)return'';if(isAddress(inputType)||isHash(inputType))return origin[0];var fieldsArray=inputType.fieldsArray;var fieldsLength=(fieldsArray||[]).length;if(fieldsLength===0)return origin;if(fieldsLength===1){var i=fieldsArray[0];return(0,_defineProperty2.default)({},i.name,origin[0]);}var result=origin;Array.isArray(fieldsArray)&&Array.isArray(origin)&&fieldsArray.forEach(function(i,k){result=Object.assign({},result,(0,_defineProperty2.default)({},i.name,origin[k]));});return result;}var encodedTx=exports.encodedTx=function(){var _ref4=(0,_asyncToGenerator2.default)(function*(_ref3){var instance=_ref3.instance,functionName=_ref3.functionName,paramsOption=_ref3.paramsOption,contract=_ref3.contract;try{var chainStatus=yield instance.chain.getChainStatus();var raw=yield contract[functionName].getSignedTx(paramsOption,{height:chainStatus==null?void 0:chainStatus.BestChainHeight,hash:chainStatus==null?void 0:chainStatus.BestChainHash});return raw;}catch(e){return{error:e};}});return function encodedTx(_x4){return _ref4.apply(this,arguments);};}();var isCrossChain=exports.isCrossChain=function isCrossChain(toAddress,fromChainId){if(!toAddress.includes('_'))return false;var arr=toAddress.split('_');var addressChainId=arr[arr.length-1];if(isAelfAddress(addressChainId)){return false;}return addressChainId!==fromChainId;};