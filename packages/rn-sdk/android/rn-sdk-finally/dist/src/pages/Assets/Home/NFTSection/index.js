var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=NFTSection;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends"));var _react=_interopRequireWildcard(require("react"));var _NoData=_interopRequireDefault(require("../../../../components/NoData"));var _reactNative=require("react-native");var _theme=require("../../../../assets/theme");var _hooks=require("../../../../i18n/hooks");var _unit=require("../../../../utils/unit");var _NFTCollectionItem=_interopRequireDefault(require("./NFTCollectionItem"));var _Touchable=_interopRequireDefault(require("../../../../components/Touchable"));var _useLockCallback=_interopRequireDefault(require("../../../../packages/hooks/useLockCallback"));var _AssetsContext=_interopRequireDefault(require("../../../../global/context/assets/AssetsContext"));var _Loading=_interopRequireDefault(require("../../../../components/Loading"));var _jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/pages/Assets/Home/NFTSection/index.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}function areEqual(prevProps,nextProps){var _prevProps$openCollec,_nextProps$openCollec;var prevNftObj=prevProps==null?void 0:(_prevProps$openCollec=prevProps.openCollectionObj)==null?void 0:_prevProps$openCollec[""+prevProps.symbol+(prevProps==null?void 0:prevProps.chainId)];var nextNftObj=nextProps==null?void 0:(_nextProps$openCollec=nextProps.openCollectionObj)==null?void 0:_nextProps$openCollec[""+nextProps.symbol+(nextProps==null?void 0:nextProps.chainId)];return nextProps.isCollapsed===prevProps.isCollapsed&&(prevNftObj==null?void 0:prevNftObj.pageNum)===(nextNftObj==null?void 0:nextNftObj.pageNum);}var NFTCollection=(0,_react.memo)(function NFTCollection(props){var symbol=props.symbol,isCollapsed=props.isCollapsed,chainId=props.chainId;return _react.default.createElement(_NFTCollectionItem.default,(0,_extends2.default)({key:""+symbol+chainId,collapsed:isCollapsed},props,{__self:this,__source:{fileName:_jsxFileName,lineNumber:43,columnNumber:10}}));},areEqual);function NFTSection(){var _this=this;var _useLanguage=(0,_hooks.useLanguage)(),t=_useLanguage.t;var _useState=(0,_react.useState)({}),_useState2=(0,_slicedToArray2.default)(_useState,2),openCollectionObj=_useState2[0],setOpenCollectionObj=_useState2[1];var _useContext=(0,_react.useContext)(_AssetsContext.default),nftCollections=_useContext.nftCollections,updateNftCollections=_useContext.updateNftCollections;var _useState3=(0,_react.useState)(false),_useState4=(0,_slicedToArray2.default)(_useState3,1),refreshing=_useState4[0];var closeItem=(0,_react.useCallback)(function(symbol,chainId){var key=""+symbol+chainId;setOpenCollectionObj(function(pre){var newObj=Object.assign({},pre);delete newObj[key];return newObj;});},[]);var openItem=(0,_useLockCallback.default)(function(){var _ref=(0,_asyncToGenerator2.default)(function*(symbol,chainId,itemCount){var key=""+symbol+chainId;_Loading.default.show();try{yield updateNftCollections({symbol:symbol});}catch(ignored){}_Loading.default.hide();setOpenCollectionObj(function(pre){return Object.assign({},pre,(0,_defineProperty2.default)({},key,{pageNum:0,pageSize:9,itemCount:itemCount}));});});return function(_x,_x2,_x3){return _ref.apply(this,arguments);};}(),[openCollectionObj]);var onRefresh=(0,_react.useCallback)((0,_asyncToGenerator2.default)(function*(){_Loading.default.show();try{yield updateNftCollections();}catch(e){console.log(e);}_Loading.default.hide();}),[updateNftCollections]);var loadMoreItem=(0,_react.useCallback)(function(){var _ref3=(0,_asyncToGenerator2.default)(function*(symbol,chainId){var pageNum=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var key=""+symbol+chainId;var currentOpenObj=openCollectionObj==null?void 0:openCollectionObj[key];setOpenCollectionObj(function(prev){return Object.assign({},prev,(0,_defineProperty2.default)({},key,Object.assign({},currentOpenObj,{pageNum:pageNum})));});});return function(_x4,_x5){return _ref3.apply(this,arguments);};}(),[openCollectionObj]);return _react.default.createElement(_reactNative.View,{style:styles.wrap,__self:this,__source:{fileName:_jsxFileName,lineNumber:127,columnNumber:5}},_react.default.createElement(_reactNative.FlatList,{data:nftCollections!=null?nftCollections:[],ListEmptyComponent:function ListEmptyComponent(){return _react.default.createElement(_Touchable.default,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:131,columnNumber:11}},_react.default.createElement(_NoData.default,{type:"top",message:t('No NFTs yet '),__self:_this,__source:{fileName:_jsxFileName,lineNumber:132,columnNumber:13}}));},renderItem:function renderItem(_ref4){var item=_ref4.item;return _react.default.createElement(NFTCollection,(0,_extends2.default)({isCollapsed:!(openCollectionObj!=null&&openCollectionObj[""+item.symbol+item.chainId]),openCollectionObj:openCollectionObj,setOpenCollectionObj:setOpenCollectionObj,openItem:openItem,closeItem:closeItem,loadMoreItem:loadMoreItem},item,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:136,columnNumber:11}}));},refreshing:refreshing,onRefresh:onRefresh,__self:this,__source:{fileName:_jsxFileName,lineNumber:128,columnNumber:7}}));}var styles=_reactNative.StyleSheet.create({wrap:{flex:1,backgroundColor:_theme.defaultColors.bg1},itemWrap:{width:'100%',height:(0,_unit.pTd)(100)}});