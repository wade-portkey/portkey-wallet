var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.useTransferLimitList=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _Loading=_interopRequireDefault(require("../../components/Loading"));var _wallet=require("../wallet");var _controller=require("../../network/controller");var _react=require("react");var PAYMENT_SECURITY_PAGE_LIMIT=20;var useTransferLimitList=exports.useTransferLimitList=function useTransferLimitList(){var _useState=(0,_react.useState)(false),_useState2=(0,_slicedToArray2.default)(_useState,2),isNext=_useState2[0],setIsNext=_useState2[1];var _useState3=(0,_react.useState)({page:0,pageSize:PAYMENT_SECURITY_PAGE_LIMIT,total:-1,list:[]}),_useState4=(0,_slicedToArray2.default)(_useState3,2),pagination=_useState4[0],setPagination=_useState4[1];var list=(0,_react.useMemo)(function(){return pagination.list;},[pagination.list]);var next=(0,_react.useCallback)((0,_asyncToGenerator2.default)(function*(){var isInit=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var _yield$getUnlockedWal=yield(0,_wallet.getUnlockedWallet)(),caHash=_yield$getUnlockedWal.caInfo.caHash;if(!caHash)return;_Loading.default.show();var nextPagination={page:0,pageSize:PAYMENT_SECURITY_PAGE_LIMIT,total:-1,list:pagination.list};if(isInit){nextPagination.page=0;nextPagination.total=-1;nextPagination.pageSize=PAYMENT_SECURITY_PAGE_LIMIT;}else if(nextPagination.page===0){isInit=true;}if(isInit)setIsNext(true);nextPagination.page++;var result=yield _controller.NetworkController.fetchTransferLimitRule({caHash:caHash||'',skipCount:(nextPagination.page-1)*nextPagination.pageSize,maxResultCount:nextPagination.pageSize});_Loading.default.hide();if(result.data&&Array.isArray(result.data)&&result.totalRecordCount!==undefined){if(result.totalRecordCount<=(nextPagination.page-1)*nextPagination.pageSize){setIsNext(false);return;}if(result.totalRecordCount<=nextPagination.page*nextPagination.pageSize){setIsNext(false);}nextPagination.total=result.totalRecordCount;nextPagination.list=result.data;setPagination(nextPagination);return;}}),[pagination.list]);var init=(0,_react.useCallback)(function(){return next(true);},[next]);return{list:list,pagination:pagination,init:init,next:next,isNext:isNext};};