var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.getElfChainStatus=exports.formatNetworkError=exports.checkRpcUrlFormat=exports.checkRpcUrl=exports.checkNetworkNameIsExist=exports.checkNetworkName=void 0;exports.isNetworkError=isNetworkError;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _types=require("./types");var _aelfSdk=_interopRequireDefault(require("aelf-sdk"));var _utils=require("../../utils");var getElfChainStatus=exports.getElfChainStatus=function(){var _ref=(0,_asyncToGenerator2.default)(function*(rpcUrl){var aelf=new _aelfSdk.default(new _aelfSdk.default.providers.HttpProvider((0,_utils.formatRpcUrl)(rpcUrl)));try{return yield aelf.chain.getChainStatus();}catch(error){throw new Error(_types.ChainActionError.InvalidRpcUrl);}});return function getElfChainStatus(_x){return _ref.apply(this,arguments);};}();var checkRpcUrlFormat=exports.checkRpcUrlFormat=function(){var _ref3=(0,_asyncToGenerator2.default)(function*(_ref2){var rpcUrl=_ref2.rpcUrl,chainType=_ref2.chainType,chainId=_ref2.chainId,blockExplorerURL=_ref2.blockExplorerURL;if(!rpcUrl)throw new Error(_types.ChainActionError.noValue);if(!(0,_utils.isUrl)(rpcUrl))throw new Error(_types.ChainActionError.InvalidRpcUrl);if(blockExplorerURL&&!(0,_utils.isUrl)(blockExplorerURL))throw new Error(_types.ChainActionError.invalidExplorerURL);if(chainType==='aelf'){var chainStatus=yield getElfChainStatus(rpcUrl);if(chainId&&chainId!==chainStatus.ChainId)throw new Error(_types.ChainActionError.chainIdError);return chainStatus;}else if(chainType==='ethereum'){throw new Error(_types.ChainActionError.notSupported);}else{throw new Error(_types.ChainActionError.notSupported);}});return function checkRpcUrlFormat(_x2){return _ref3.apply(this,arguments);};}();var checkRpcUrl=exports.checkRpcUrl=function(){var _ref5=(0,_asyncToGenerator2.default)(function*(_ref4){var _ref4$chainList=_ref4.chainList,chainList=_ref4$chainList===void 0?[]:_ref4$chainList,rpcUrl=_ref4.rpcUrl,chainType=_ref4.chainType,key=_ref4.key;var flag=chainList.some(function(chain){return chain.rpcUrl===rpcUrl&&chain.key!==key;});if(flag)throw new Error(_types.ChainActionError.rpcUrlAlreadyExists);var chainStatus=yield checkRpcUrlFormat({rpcUrl:rpcUrl,chainType:chainType});return chainStatus.ChainId;});return function checkRpcUrl(_x3){return _ref5.apply(this,arguments);};}();var checkNetworkName=exports.checkNetworkName=function checkNetworkName(){var chainList=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var name=arguments.length>1?arguments[1]:undefined;var t=arguments.length>2?arguments[2]:undefined;var key=arguments.length>3?arguments[3]:undefined;if(!name)throw new Error(t?t(_types.ChainActionError.noName):_types.ChainActionError.noName);console.log(key,name,chainList,'key');if(name.length>50)throw new Error(t?t(_types.ChainActionError.nameMaxLength):_types.ChainActionError.nameMaxLength);if(chainList!=null&&chainList.some(function(item){return item.networkName===name&&item.key!==key;}))throw new Error(t?t(_types.ChainActionError.nameHave):_types.ChainActionError.nameHave);return true;};var checkNetworkNameIsExist=exports.checkNetworkNameIsExist=function checkNetworkNameIsExist(){var chainList=arguments.length>0&&arguments[0]!==undefined?arguments[0]:[];var name=arguments.length>1?arguments[1]:undefined;return chainList==null?void 0:chainList.some(function(item){return item.networkName===name;});};var networkError=(0,_utils.enumToMap)(_types.ChainActionError);var formatNetworkError=exports.formatNetworkError=function formatNetworkError(error){var message=isNetworkError(error);if(!message)return message;switch(message){case _types.ChainActionError.chainIdError:case _types.ChainActionError.noChainId:return{chainId:error.message};case _types.ChainActionError.rpcUrlAlreadyExists:case _types.ChainActionError.actionTypeError:case _types.ChainActionError.notExist:case _types.ChainActionError.notSupported:case _types.ChainActionError.noValue:case _types.ChainActionError.InvalidRpcUrl:case _types.ChainActionError.hasRpcUrl:return{rpcUrl:error.message};case _types.ChainActionError.nameHave:case _types.ChainActionError.noName:case _types.ChainActionError.nameMaxLength:case _types.ChainActionError.hasName:return{networkName:error.message};case _types.ChainActionError.invalidExplorerURL:return{blockExplorerURL:error.message};}};function isNetworkError(error){if(networkError[error==null?void 0:error.message]){return error.message;}return false;}