var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.SandboxEventService=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _=require("./..");var SandboxEventService=exports.SandboxEventService=function(){function SandboxEventService(){(0,_classCallCheck2.default)(this,SandboxEventService);}(0,_createClass2.default)(SandboxEventService,null,[{key:"dispatch",value:function dispatch(event,data){var ele=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'sandbox';var iframe=document.getElementById(ele);var sid=(0,_.randomId)();iframe==null?void 0:iframe.contentWindow.postMessage({event:event,data:Object.assign({},data,{sid:sid})},'*');return{event:event,sid:sid};}},{key:"dispatchToOrigin",value:function dispatchToOrigin(event,data){var _event$source;event==null?void 0:(_event$source=event.source)==null?void 0:_event$source.postMessage(Object.assign({},data,{eventName:event.data.event}),event.origin);}},{key:"listen",value:function listen(_ref){var eventName=_ref.event,sid=_ref.sid;return new Promise(function(resolve){window.addEventListener('message',function(event){if(event.data.eventName===eventName&&event.data.sid===sid)resolve(event.data);});});}},{key:"dispatchAndReceive",value:(function(){var _dispatchAndReceive=(0,_asyncToGenerator2.default)(function*(event,data){var ele=arguments.length>2&&arguments[2]!==undefined?arguments[2]:'sandbox';var dispatchKey=SandboxEventService.dispatch(event,data,ele);return yield SandboxEventService.listen(dispatchKey);});function dispatchAndReceive(_x,_x2){return _dispatchAndReceive.apply(this,arguments);}return dispatchAndReceive;}())}]);return SandboxEventService;}();