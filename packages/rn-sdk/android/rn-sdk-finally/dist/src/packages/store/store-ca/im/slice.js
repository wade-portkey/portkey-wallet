var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.imSlice=exports.default=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _toolkit=require("@reduxjs/toolkit");var _type=require("./type");var _actions=require("./actions");var _util=require("./util");var initialState={channelListNetMap:{},hasNextNetMap:{},channelMessageListNetMap:{},relationIdNetMap:{},relationTokenNetMap:{}};var imSlice=exports.imSlice=(0,_toolkit.createSlice)({name:'im',initialState:initialState,reducers:{},extraReducers:function extraReducers(builder){builder.addCase(_actions.setRelationId,function(state,action){state.relationIdNetMap[action.payload.network]=action.payload.relationId;}).addCase(_actions.setChannelList,function(state,action){state.channelListNetMap[action.payload.network]=(0,_util.formatChannelList)(action.payload.channelList);}).addCase(_actions.nextChannelList,function(state,action){var _state$channelListNet;var _action$payload=action.payload,network=_action$payload.network,channelList=_action$payload.channelList;var preList=((_state$channelListNet=state.channelListNetMap[network])==null?void 0:_state$channelListNet.list)||[];var newChannelList={list:[].concat((0,_toConsumableArray2.default)(preList),(0,_toConsumableArray2.default)(channelList.list)),cursor:channelList.cursor};newChannelList=(0,_util.formatChannelList)(newChannelList);state.channelListNetMap[network]=newChannelList;}).addCase(_actions.setHasNext,function(state,action){state.hasNextNetMap[action.payload.network]=action.payload.hasNext;}).addCase(_actions.updateChannelAttribute,function(state,action){var _action$payload2=action.payload,network=_action$payload2.network,channelId=_action$payload2.channelId,value=_action$payload2.value,type=_action$payload2.type;var preChannelList=state.channelListNetMap[network];if(!preChannelList)return state;var channelList=Object.assign({},preChannelList,{list:preChannelList.list.map(function(item){if(item.channelUuid===channelId){var plusAttribute;switch(type){case _type.UpdateChannelAttributeTypeEnum.UPDATE_UNREAD_CHANNEL:plusAttribute={unreadMessageCount:item.unreadMessageCount+1};break;default:break;}return Object.assign({},item,value,plusAttribute);}return item;})});channelList=(0,_util.formatChannelList)(channelList);state.channelListNetMap[network]=channelList;}).addCase(_actions.addChannel,function(state,action){var _action$payload3=action.payload,network=_action$payload3.network,channel=_action$payload3.channel;var preChannelList=state.channelListNetMap[network];var preList=(preChannelList==null?void 0:preChannelList.list)||[];if(preList.find(function(item){return item.channelUuid===channel.channelUuid;})){return state;}var channelList=(0,_util.formatChannelList)({list:[channel].concat((0,_toConsumableArray2.default)(preList)),cursor:(preChannelList==null?void 0:preChannelList.cursor)||''});state.channelListNetMap[network]=channelList;}).addCase(_actions.removeChannel,function(state,action){var _action$payload4=action.payload,network=_action$payload4.network,channelId=_action$payload4.channelId;var preChannelList=state.channelListNetMap[network];if(!preChannelList)return state;var channelList=Object.assign({},preChannelList,{list:preChannelList.list.filter(function(item){return item.channelUuid!==channelId;})});channelList=(0,_util.formatChannelList)(channelList);state.channelListNetMap[network]=channelList;}).addCase(_actions.setChannelMessageList,function(state,action){var _state$channelMessage;var _action$payload5=action.payload,network=_action$payload5.network,channelId=_action$payload5.channelId,list=_action$payload5.list;return Object.assign({},state,{channelMessageListNetMap:Object.assign({},state.channelMessageListNetMap,(0,_defineProperty2.default)({},network,Object.assign({},(_state$channelMessage=state.channelMessageListNetMap)==null?void 0:_state$channelMessage[network],(0,_defineProperty2.default)({},channelId,list))))});}).addCase(_actions.nextChannelMessageList,function(state,action){var _state$channelMessage2,_state$channelMessage3,_state$channelMessage4;var _action$payload6=action.payload,network=_action$payload6.network,channelId=_action$payload6.channelId,list=_action$payload6.list;return Object.assign({},state,{channelMessageListNetMap:Object.assign({},state.channelMessageListNetMap,(0,_defineProperty2.default)({},network,Object.assign({},(_state$channelMessage2=state.channelMessageListNetMap)==null?void 0:_state$channelMessage2[network],(0,_defineProperty2.default)({},channelId,[].concat((0,_toConsumableArray2.default)(list),(0,_toConsumableArray2.default)(((_state$channelMessage3=state.channelMessageListNetMap)==null?void 0:(_state$channelMessage4=_state$channelMessage3[network])==null?void 0:_state$channelMessage4[channelId])||[]))))))});}).addCase(_actions.addChannelMessage,function(state,action){var _state$channelMessage5,_state$channelMessage6,_state$channelMessage7;var _action$payload7=action.payload,network=_action$payload7.network,channelId=_action$payload7.channelId,message=_action$payload7.message;return Object.assign({},state,{channelMessageListNetMap:Object.assign({},state.channelMessageListNetMap,(0,_defineProperty2.default)({},network,Object.assign({},(_state$channelMessage5=state.channelMessageListNetMap)==null?void 0:_state$channelMessage5[network],(0,_defineProperty2.default)({},channelId,[].concat((0,_toConsumableArray2.default)(((_state$channelMessage6=state.channelMessageListNetMap)==null?void 0:(_state$channelMessage7=_state$channelMessage6[network])==null?void 0:_state$channelMessage7[channelId])||[]),[message])))))});}).addCase(_actions.deleteChannelMessage,function(state,action){var _state$channelMessage8,_state$channelMessage9,_state$channelMessage10,_state$channelMessage11;var _action$payload8=action.payload,network=_action$payload8.network,channelId=_action$payload8.channelId,id=_action$payload8.id;return Object.assign({},state,{channelMessageListNetMap:Object.assign({},state.channelMessageListNetMap,(0,_defineProperty2.default)({},network,Object.assign({},(_state$channelMessage8=state.channelMessageListNetMap)==null?void 0:_state$channelMessage8[network],(0,_defineProperty2.default)({},channelId,(0,_toConsumableArray2.default)(((_state$channelMessage9=state.channelMessageListNetMap)==null?void 0:(_state$channelMessage10=_state$channelMessage9[network])==null?void 0:(_state$channelMessage11=_state$channelMessage10[channelId])==null?void 0:_state$channelMessage11.filter(function(item){return item.id!==id;}))||[])))))});}).addCase(_actions.updateChannelMessageAttribute,function(state,action){var _state$channelMessage12,_state$channelMessage13,_state$channelMessage14,_state$channelMessage15;var _action$payload9=action.payload,network=_action$payload9.network,channelId=_action$payload9.channelId,sendUuid=_action$payload9.sendUuid,value=_action$payload9.value;return Object.assign({},state,{channelMessageListNetMap:Object.assign({},state.channelMessageListNetMap,(0,_defineProperty2.default)({},network,Object.assign({},(_state$channelMessage12=state.channelMessageListNetMap)==null?void 0:_state$channelMessage12[network],(0,_defineProperty2.default)({},channelId,(0,_toConsumableArray2.default)(((_state$channelMessage13=state.channelMessageListNetMap)==null?void 0:(_state$channelMessage14=_state$channelMessage13[network])==null?void 0:(_state$channelMessage15=_state$channelMessage14[channelId])==null?void 0:_state$channelMessage15.map(function(item){if(item.sendUuid===sendUuid){return Object.assign({},item,value);}return item;}))||[])))))});}).addCase(_actions.setRelationToken,function(state,action){state.relationTokenNetMap[action.payload.network]=action.payload.token;}).addCase(_actions.resetIm,function(state,action){return Object.assign({},state,{channelListNetMap:Object.assign({},state.channelListNetMap,(0,_defineProperty2.default)({},action.payload,undefined)),hasNextNetMap:Object.assign({},state.hasNextNetMap,(0,_defineProperty2.default)({},action.payload,undefined)),channelMessageListNetMap:Object.assign({},state.channelMessageListNetMap,(0,_defineProperty2.default)({},action.payload,undefined)),relationIdNetMap:Object.assign({},state.relationIdNetMap,(0,_defineProperty2.default)({},action.payload,undefined)),relationTokenNetMap:Object.assign({},state.relationTokenNetMap,(0,_defineProperty2.default)({},action.payload,undefined))});});}});var _default=exports.default=imSlice;