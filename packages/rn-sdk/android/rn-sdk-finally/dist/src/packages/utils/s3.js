var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.getThumbSize=exports.formatRNImage=exports.default=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _s=_interopRequireDefault(require("aws-sdk/clients/s3"));var _awsSdk=_interopRequireDefault(require("aws-sdk"));var _index=require("./index");var _class;var AWSManager=function(){function AWSManager(options){(0,_classCallCheck2.default)(this,AWSManager);(0,_defineProperty2.default)(this,"uploadBaseConfig",{Bucket:'',Key:'',Body:null,ACL:'public-read'});this.uploadBaseConfig=Object.assign(this.uploadBaseConfig,options);}(0,_createClass2.default)(AWSManager,[{key:"uploadFile",value:function(){var _uploadFile=(0,_asyncToGenerator2.default)(function*(file){var uuid=(0,_index.randomId)();var upload=new _s.default.ManagedUpload({params:Object.assign({},this.uploadBaseConfig,{Key:uuid+"-"+Date.now()+(file.suffix?'.'+file.suffix:''),Body:typeof file.body==='string'?Buffer.from(file.body,'base64'):file.body})});var timer=setTimeout(function(){console.log('=====uploadFile abort');upload.abort();},12000);try{var res=yield upload.promise();clearTimeout(timer);return{url:(res==null?void 0:res.Location)||'',key:(res==null?void 0:res.Key)||'',hash:res!=null&&res.ETag?res.ETag.replace(/"/g,''):''};}catch(error){clearTimeout(timer);console.error('=====uploadFile error:',error);return Promise.reject(null);}});function uploadFile(_x){return _uploadFile.apply(this,arguments);}return uploadFile;}()},{key:"setConfig",value:function setConfig(_ref){var bucket=_ref.bucket,key=_ref.key;this.uploadBaseConfig.Bucket=bucket;_awsSdk.default.config.update({region:'ap-northeast-1',credentials:new _awsSdk.default.CognitoIdentityCredentials({IdentityPoolId:key})});}}],[{key:"get",value:function get(){if(!AWSManager.instance){AWSManager.instance=new AWSManager();}return AWSManager.instance;}}]);return AWSManager;}();_class=AWSManager;(0,_defineProperty2.default)(AWSManager,"instance",null);var _default=exports.default=AWSManager.get();var formatRNImage=exports.formatRNImage=function formatRNImage(file,fileBase64){console.log(file);return{body:fileBase64,suffix:file.uri.split('.').pop(),width:file.width,height:file.height};};var getThumbSize=exports.getThumbSize=function getThumbSize(width,height){var max=arguments.length>2&&arguments[2]!==undefined?arguments[2]:100;var min=1;var ratio=Math.min(max/width,max/height);if(ratio>=1)return{thumbWidth:width,thumbHeight:height};var thumbWidth=Math.floor(Math.max(min,width*ratio));var thumbHeight=Math.floor(Math.max(min,height*ratio));return{thumbWidth:thumbWidth,thumbHeight:thumbHeight};};