var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.useIntervalQueryCAInfoByAddress=useIntervalQueryCAInfoByAddress;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _useInterval=_interopRequireDefault(require("../packages/hooks/useInterval"));var _graphql=require("../packages/graphql");var _react=require("react");var _verifier=require("../packages/types/verifier");var _network=require("../packages/constants/constants-ca/network");function useIntervalQueryCAInfoByAddress(network,address){var _useState=(0,_react.useState)(),_useState2=(0,_slicedToArray2.default)(_useState,2),info=_useState2[0],setInfo=_useState2[1];var caInfo=(0,_react.useMemo)(function(){return address&&info?info==null?void 0:info[address+network]:undefined;},[address,info,network]);(0,_useInterval.default)((0,_asyncToGenerator2.default)(function*(){if(!address||caInfo)return;try{var _info;var _yield$contractQuerie=yield _graphql.contractQueries.getCAHolderByManager(network,{manager:address}),caHolderManagerInfo=_yield$contractQuerie.caHolderManagerInfo;console.log(caHolderManagerInfo,'=====caHolderManagerInfo');_info=caHolderManagerInfo[0];if(!_info)return;if(_info.originChainId!==_info.chainId){var _yield$contractQuerie2=yield _graphql.contractQueries.getCAHolderByManager(network,{caHash:_info.caHash,chainId:_info.originChainId}),_caHolderManagerInfo=_yield$contractQuerie2.caHolderManagerInfo;_info=_caHolderManagerInfo[0];}var _info2=_info,caAddress=_info2.caAddress,caHash=_info2.caHash,loginGuardianInfo=_info2.loginGuardianInfo,_info2$originChainId=_info2.originChainId,originChainId=_info2$originChainId===void 0?_network.DefaultChainId:_info2$originChainId;if(caAddress&&caHash&&loginGuardianInfo[0]&&originChainId){var _loginGuardianInfo$0$,_loginGuardianInfo$0$2;var guardianList=loginGuardianInfo.filter(function(item){return(item==null?void 0:item.chainId)===originChainId;});if(guardianList.length===0)return;setInfo((0,_defineProperty2.default)({},address+network,{caInfo:(0,_defineProperty2.default)({originChainId:originChainId,managerInfo:{managerUniqueId:loginGuardianInfo[0].id,loginAccount:(_loginGuardianInfo$0$=loginGuardianInfo[0].loginGuardian)==null?void 0:_loginGuardianInfo$0$.identifierHash,type:(_loginGuardianInfo$0$2=loginGuardianInfo[0].loginGuardian)==null?void 0:_loginGuardianInfo$0$2.type,verificationType:_verifier.VerificationType.addManager}},originChainId,{caAddress:caAddress,caHash:caHash}),originChainId:originChainId}));}}catch(error){console.log(error,'=====error');}}),3000,[caInfo,network,address]);return caInfo;}