var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=Biometric;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _PageContainer=_interopRequireDefault(require("../../../components/PageContainer"));var _ListItem=_interopRequireDefault(require("../../../components/ListItem"));var _CommonToast=_interopRequireDefault(require("../../../components/CommonToast"));var _reactNative=require("react-native");var _theme=require("../../../assets/theme");var _useEffectOnce=_interopRequireDefault(require("../../../hooks/useEffectOnce"));var _hooks=require("../../../i18n/hooks");var _i18n=_interopRequireDefault(require("../../../i18n"));var _CommonText=require("../../../components/CommonText");var _ActionSheet=_interopRequireDefault(require("../../../components/ActionSheet"));var _deviceEvent=_interopRequireDefault(require("../../../utils/deviceEvent"));var _core=require("../../../model/verify/core");var _UseBaseContainer=_interopRequireDefault(require("../../../model/container/UseBaseContainer"));var _entries=require("../../../config/entries");var _BaseContainerContext=_interopRequireDefault(require("../../../model/container/BaseContainerContext"));var _authentication=require("../../../packages/utils/mobile/authentication");var _biometric=require("../../../service/biometric");var _jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/pages/My/Biometric/index.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}function Biometric(){var _useState=(0,_react.useState)(false),_useState2=(0,_slicedToArray2.default)(_useState,2),biometricsSwitch=_useState2[0],setBiometricsSwitch=_useState2[1];var _useState3=(0,_react.useState)(true),_useState4=(0,_slicedToArray2.default)(_useState3,2),biometricsReady=_useState4[0],setBiometricsReady=_useState4[1];(0,_react.useEffect)(function(){Promise.all([(0,_core.getUseBiometric)(),(0,_authentication.authenticationReady)()]).then(function(results){setBiometricsSwitch(results[0]);setBiometricsReady(results[1]);}).catch(function(error){console.log(error);});},[]);var _useBaseContainer=(0,_UseBaseContainer.default)({entryName:_entries.PortkeyEntries.BIOMETRIC_SWITCH_ENTRY}),navigationTo=_useBaseContainer.navigateTo;var _useLanguage=(0,_hooks.useLanguage)(),t=_useLanguage.t;var openBiometrics=(0,_react.useCallback)(function(){var _ref=(0,_asyncToGenerator2.default)(function*(pin){if(pin==='use-bio'||(yield(0,_core.checkPin)(pin))){try{if(yield(0,_biometric.authenticateBioReady)()){console.log('authenticateBioReady');var enrolled=yield(0,_biometric.authenticateBioAsync)();console.log('authenticateBioAsyncauthenticateBioAsyncauthenticateBioAsync',enrolled);if(enrolled.success){setBiometricsSwitch(true);yield(0,_core.rememberUseBiometric)(true);}else _CommonToast.default.fail(enrolled.warning||enrolled.error);}else{setBiometricsSwitch(true);yield(0,_core.rememberUseBiometric)(true);}}catch(error){console.log('error',error);_CommonToast.default.failError(error,_i18n.default.t('Failed to enable biometrics'));yield(0,_core.rememberUseBiometric)(false);}}});return function(_x){return _ref.apply(this,arguments);};}(),[]);(0,_useEffectOnce.default)(function(){var listener=_deviceEvent.default.openBiometrics.addListener(openBiometrics);return function(){return listener.remove();};});var onValueChange=(0,_react.useCallback)(function(){var _ref2=(0,_asyncToGenerator2.default)(function*(value){if(value){navigationTo(_entries.PortkeyEntries.CHECK_PIN,{params:{openBiometrics:true}});}else{_ActionSheet.default.alert({title2:'Disable fingerprint login?',buttons:[{type:'outline',title:'Cancel'},{type:'primary',title:'Confirm',onPress:function(){var _onPress=(0,_asyncToGenerator2.default)(function*(){try{var enrolled=yield(0,_biometric.authenticateBioAsync)();if(enrolled.success){setBiometricsSwitch(value);yield(0,_core.rememberUseBiometric)(value);}else _CommonToast.default.fail(enrolled.warning||enrolled.error);}catch(error){_CommonToast.default.failError(error,_i18n.default.t('Failed to enable biometrics'));}});function onPress(){return _onPress.apply(this,arguments);}return onPress;}()}]});}});return function(_x2){return _ref2.apply(this,arguments);};}(),[navigationTo]);return _react.default.createElement(_BaseContainerContext.default.Provider,{value:{entryName:_entries.PortkeyEntries.ACCOUNT_SETTING_ENTRY},__self:this,__source:{fileName:_jsxFileName,lineNumber:98,columnNumber:5}},_react.default.createElement(_PageContainer.default,{containerStyles:styles.containerStyles,safeAreaColor:['blue','gray'],titleDom:t('Biometric'),__self:this,__source:{fileName:_jsxFileName,lineNumber:99,columnNumber:7}},biometricsReady&&_react.default.createElement(_react.default.Fragment,null,_react.default.createElement(_ListItem.default,{disabled:true,switching:true,switchValue:biometricsSwitch,style:styles.listStyle,onValueChange:onValueChange,title:t('Biometric Authentication'),__self:this,__source:{fileName:_jsxFileName,lineNumber:105,columnNumber:13}}),_react.default.createElement(_CommonText.TextM,{style:styles.tipText,__self:this,__source:{fileName:_jsxFileName,lineNumber:113,columnNumber:13}},"Enable biometric authentication to quickly unlock the device"))));}var styles=_reactNative.StyleSheet.create({containerStyles:{paddingTop:8,backgroundColor:_theme.defaultColors.bg4},listStyle:{marginTop:24,marginBottom:0},tipText:{paddingLeft:8,marginTop:24,color:_theme.defaultColors.font3}});