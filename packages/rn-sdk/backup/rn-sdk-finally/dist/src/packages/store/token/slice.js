var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.tokenSlice=exports.resetToken=exports.fetchTokenListAsync=exports.deleteTokenInCurrentAccount=exports.default=exports.clearMarketToken=exports.addTokenInCurrentAccount=void 0;var _toConsumableArray2=_interopRequireDefault(require("@babel/runtime/helpers/toConsumableArray"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _toolkit=require("@reduxjs/toolkit");var _api=require("./api");var _token=require("../../utils/token");var initialState={addedTokenData:{},tokenDataShowInMarket:[],isFetchingTokenList:false};var fetchTokenListAsync=exports.fetchTokenListAsync=(0,_toolkit.createAsyncThunk)('token/fetchTokenList',function(){var _ref2=(0,_asyncToGenerator2.default)(function*(_ref){var pageNo=_ref.pageNo,pageSize=_ref.pageSize,currentChain=_ref.currentChain,currentAccount=_ref.currentAccount;var response=yield(0,_api.fetchTokenList)({pageNo:pageNo,pageSize:pageSize,chainId:'currentChain'});return{list:response.data,currentChain:currentChain,currentAccount:currentAccount};});return function(_x){return _ref2.apply(this,arguments);};}());var tokenSlice=exports.tokenSlice=(0,_toolkit.createSlice)({name:'token',initialState:initialState,reducers:{addTokenInCurrentAccount:function addTokenInCurrentAccount(state,action){var _action$payload=action.payload,tokenItem=_action$payload.tokenItem,currentChain=_action$payload.currentChain,currentAccount=_action$payload.currentAccount;var chainKey=currentChain.rpcUrl;var accountKey=currentAccount.address;state.addedTokenData[chainKey][accountKey].push(tokenItem);state.tokenDataShowInMarket=state.tokenDataShowInMarket.map(function(ele){return Object.assign({},ele,{isAdded:(0,_token.isSameTypeToken)(ele,tokenItem)?true:ele.isAdded});});state.addedTokenData=state.addedTokenData;},deleteTokenInCurrentAccount:function deleteTokenInCurrentAccount(state,action){var _action$payload2=action.payload,tokenItem=_action$payload2.tokenItem,currentChain=_action$payload2.currentChain,currentAccount=_action$payload2.currentAccount;var chainKey=currentChain.rpcUrl;var accountKey=currentAccount.address;state.addedTokenData[chainKey][accountKey]=state.addedTokenData[chainKey][accountKey].filter(function(ele){return!(0,_token.isSameTypeToken)(ele,tokenItem);});state.tokenDataShowInMarket=state.tokenDataShowInMarket.map(function(ele){return Object.assign({},ele,{isAdded:(0,_token.isSameTypeToken)(ele,tokenItem)?false:ele.isAdded});});state.addedTokenData=state.addedTokenData;},clearMarketToken:function clearMarketToken(state){console.log('initCurrentAccountToken');state.tokenDataShowInMarket=[];},resetToken:function resetToken(state){state.addedTokenData={};state.tokenDataShowInMarket=[];}},extraReducers:function extraReducers(builder){builder.addCase(fetchTokenListAsync.pending,function(state){state.isFetchingTokenList=true;}).addCase(fetchTokenListAsync.fulfilled,function(state,action){var _action$payload3=action.payload,list=_action$payload3.list,currentChain=_action$payload3.currentChain,currentAccount=_action$payload3.currentAccount;var chainKey=currentChain.rpcUrl;var accountKey=currentAccount.address;var defaultItemList=list.filter(function(ele){return ele.isDefault;});if(!state.addedTokenData[chainKey]){state.addedTokenData[chainKey]={};}if(!state.addedTokenData[chainKey][accountKey]){state.addedTokenData[chainKey][accountKey]=defaultItemList;}var newShowListByPage=list.map(function(ele){var _state$addedTokenData;return Object.assign({},ele,{isAdded:!!((_state$addedTokenData=state==null?void 0:state.addedTokenData[chainKey][accountKey])!=null?_state$addedTokenData:[]).find(function(token){return(0,_token.isSameTypeToken)(token,ele);})});});state.tokenDataShowInMarket=[].concat((0,_toConsumableArray2.default)(state.tokenDataShowInMarket),(0,_toConsumableArray2.default)(newShowListByPage));state.isFetchingTokenList=false;}).addCase(fetchTokenListAsync.rejected,function(state){state.isFetchingTokenList=false;});}});var _tokenSlice$actions=tokenSlice.actions,addTokenInCurrentAccount=exports.addTokenInCurrentAccount=_tokenSlice$actions.addTokenInCurrentAccount,deleteTokenInCurrentAccount=exports.deleteTokenInCurrentAccount=_tokenSlice$actions.deleteTokenInCurrentAccount,clearMarketToken=exports.clearMarketToken=_tokenSlice$actions.clearMarketToken,resetToken=exports.resetToken=_tokenSlice$actions.resetToken;var _default=exports.default=tokenSlice;