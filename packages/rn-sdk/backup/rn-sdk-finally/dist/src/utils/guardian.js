Object.defineProperty(exports,"__esModule",{value:true});exports.addGuardian=addGuardian;exports.cancelLoginAccount=cancelLoginAccount;exports.deleteGuardian=deleteGuardian;exports.editGuardian=editGuardian;exports.encodedDeletionManager=encodedDeletionManager;exports.removeManager=removeManager;exports.removeOtherManager=removeOtherManager;exports.setLoginAccount=setLoginAccount;var _guardian=require("../packages/utils/guardian");var getGuardiansApproved=function getGuardiansApproved(userGuardiansList,guardiansStatus){return userGuardiansList.map(function(guardian){var _guardiansStatus$guar,_guardian$verifier,_guardiansStatus$guar2;if(!guardiansStatus[guardian.key]||!guardiansStatus[guardian.key].verifierInfo)return null;var verificationDoc=((_guardiansStatus$guar=guardiansStatus[guardian.key].verifierInfo)==null?void 0:_guardiansStatus$guar.verificationDoc)||'';var _handleVerificationDo=(0,_guardian.handleVerificationDoc)(verificationDoc),guardianIdentifier=_handleVerificationDo.guardianIdentifier;return{identifierHash:guardianIdentifier,type:guardian.guardianType,verificationInfo:{id:(_guardian$verifier=guardian.verifier)==null?void 0:_guardian$verifier.id,signature:Object.values(Buffer.from((_guardiansStatus$guar2=guardiansStatus[guardian.key].verifierInfo)==null?void 0:_guardiansStatus$guar2.signature,'hex')),verificationDoc:verificationDoc}};}).filter(function(item){return item!==null;});};function deleteGuardian(contract,address,caHash,guardianItem,userGuardiansList,guardiansStatus){var _guardianItem$verifie;var guardianToRemove={identifierHash:guardianItem.identifierHash,type:guardianItem.guardianType,verificationInfo:{id:(_guardianItem$verifie=guardianItem.verifier)==null?void 0:_guardianItem$verifie.id}};var guardiansApproved=getGuardiansApproved(userGuardiansList,guardiansStatus);return contract==null?void 0:contract.callSendMethod('RemoveGuardian',address,{caHash:caHash,guardianToRemove:guardianToRemove,guardiansApproved:guardiansApproved});}function addGuardian(contract,address,caHash,verifierInfo,guardianItem,userGuardiansList,guardiansStatus){var _guardianItem$verifie2;var _handleVerificationDo2=(0,_guardian.handleVerificationDoc)(verifierInfo.verificationDoc),guardianIdentifier=_handleVerificationDo2.guardianIdentifier;var guardianToAdd={identifierHash:guardianIdentifier,type:guardianItem.guardianType,verificationInfo:{id:(_guardianItem$verifie2=guardianItem.verifier)==null?void 0:_guardianItem$verifie2.id,signature:Object.values(Buffer.from(verifierInfo.signature,'hex')),verificationDoc:verifierInfo.verificationDoc}};var guardiansApproved=getGuardiansApproved(userGuardiansList,guardiansStatus);return contract==null?void 0:contract.callSendMethod('AddGuardian',address,{caHash:caHash,guardianToAdd:guardianToAdd,guardiansApproved:guardiansApproved});}function editGuardian(contract,address,caHash,preGuardianItem,guardianItem,userGuardiansList,guardiansStatus){var _preGuardianItem$veri,_guardianItem$verifie3;var guardianToUpdatePre={identifierHash:preGuardianItem.identifierHash,type:preGuardianItem.guardianType,verificationInfo:{id:(_preGuardianItem$veri=preGuardianItem.verifier)==null?void 0:_preGuardianItem$veri.id}};var guardianToUpdateNew={identifierHash:preGuardianItem.identifierHash,type:guardianItem.guardianType,verificationInfo:{id:(_guardianItem$verifie3=guardianItem.verifier)==null?void 0:_guardianItem$verifie3.id}};var guardiansApproved=getGuardiansApproved(userGuardiansList,guardiansStatus);return contract==null?void 0:contract.callSendMethod('UpdateGuardian',address,{caHash:caHash,guardianToUpdatePre:guardianToUpdatePre,guardianToUpdateNew:guardianToUpdateNew,guardiansApproved:guardiansApproved});}function setLoginAccount(contract,address,caHash,guardianItem){var _guardianItem$verifie4;return contract==null?void 0:contract.callSendMethod('SetGuardianForLogin',address,{caHash:caHash,guardian:{type:guardianItem.guardianType,verifierId:(_guardianItem$verifie4=guardianItem.verifier)==null?void 0:_guardianItem$verifie4.id,identifierHash:guardianItem.identifierHash}});}function cancelLoginAccount(contract,address,caHash,guardianItem){var _guardianItem$verifie5;return contract==null?void 0:contract.callSendMethod('UnsetGuardianForLogin',address,{caHash:caHash,guardian:{type:guardianItem.guardianType,verifierId:(_guardianItem$verifie5=guardianItem.verifier)==null?void 0:_guardianItem$verifie5.id,identifierHash:guardianItem.identifierHash}});}function removeManager(contract,address,caHash){return contract==null?void 0:contract.callSendMethod('RemoveManagerInfo',address,{caHash:caHash,managerInfo:{address:address,extraData:Date.now()}});}function encodedDeletionManager(contract,address,caHash){return contract==null?void 0:contract.encodedTx('RemoveManagerInfo',{caHash:caHash,managerInfo:{address:address,extraData:Date.now()}});}function removeOtherManager(contract,address,caHash,userGuardiansList,guardiansStatus){var managerInfo={address:address,extraData:Date.now()};var guardiansApproved=getGuardiansApproved(userGuardiansList,guardiansStatus);return contract==null?void 0:contract.callSendMethod('RemoveOtherManagerInfo',address,{caHash:caHash,managerInfo:managerInfo,guardiansApproved:guardiansApproved});}