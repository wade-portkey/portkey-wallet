var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.styles=exports.showAssetList=exports.default=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));var _react=_interopRequireWildcard(require("react"));var _OverlayModal=_interopRequireDefault(require("../../../../components/OverlayModal"));var _reactNative=require("react-native");var _CommonText=require("../../../../components/CommonText");var _ModalBody=require("../../../../components/ModalBody");var _CommonInput=_interopRequireDefault(require("../../../../components/CommonInput"));var _unit=require("../../../../utils/unit");var _hooks=require("../../../../i18n/hooks");var _useDebounce=_interopRequireDefault(require("../../../../hooks/useDebounce"));var _NoData=_interopRequireDefault(require("../../../../components/NoData"));var _themed=require("@rneui/themed");var _theme=require("../../../../assets/theme");var _wallet=require("../../../../packages/hooks/hooks-ca/wallet");var _TokenListItem=_interopRequireDefault(require("../../../../components/TokenListItem"));var _styles=require("../../../../assets/theme/styles");var _api=require("packages/types/store-ca/assets/api");var _navigationService=_interopRequireDefault(require("utils/navigationService"));var _utils=require("../../../../packages/utils");var _useGStyles=require("../../../../assets/theme/useGStyles");var _deviceEvent=_interopRequireDefault(require("../../../../utils/deviceEvent"));var _useEffectOnce=_interopRequireDefault(require("../../../../hooks/useEffectOnce"));var _useTokensPrice=require("../../../../packages/hooks/hooks-ca/useTokensPrice");var _this=this,_jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/pages/Assets/Home/AssetsOverlay/index.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var AssetItem=function AssetItem(props){var symbol=props.symbol,_onPress=props.onPress,item=props.item;var _useWallet=(0,_wallet.useWallet)(),currentNetwork=_useWallet.currentNetwork;if(item.tokenInfo)return _react.default.createElement(_TokenListItem.default,{item:Object.assign({},item,item==null?void 0:item.tokenInfo,{tokenContractAddress:item.address}),onPress:function onPress(){return _onPress(item);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:35,columnNumber:7}});if(item.nftInfo){var _item$nftInfo,_item$nftInfo2;var tokenId=item.nftInfo.tokenId;return _react.default.createElement(_reactNative.TouchableOpacity,{style:itemStyle.wrap,onPress:function onPress(){return _onPress==null?void 0:_onPress(item);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:46,columnNumber:7}},item.nftInfo.imageUrl?_react.default.createElement(_themed.Image,{resizeMode:'contain',style:[itemStyle.left],source:{uri:item==null?void 0:(_item$nftInfo=item.nftInfo)==null?void 0:_item$nftInfo.imageUrl},__self:_this,__source:{fileName:_jsxFileName,lineNumber:48,columnNumber:11}}):_react.default.createElement(_reactNative.Text,{style:[itemStyle.left,itemStyle.noPic],__self:_this,__source:{fileName:_jsxFileName,lineNumber:50,columnNumber:11}},item.symbol[0]),_react.default.createElement(_reactNative.View,{style:itemStyle.right,__self:_this,__source:{fileName:_jsxFileName,lineNumber:52,columnNumber:9}},_react.default.createElement(_reactNative.View,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:53,columnNumber:11}},_react.default.createElement(_CommonText.TextL,{numberOfLines:1,ellipsizeMode:'tail',style:[_styles.FontStyles.font5],__self:_this,__source:{fileName:_jsxFileName,lineNumber:54,columnNumber:13}},symbol+" #"+tokenId),_react.default.createElement(_CommonText.TextS,{numberOfLines:1,style:[_styles.FontStyles.font3,itemStyle.nftItemInfo],__self:_this,__source:{fileName:_jsxFileName,lineNumber:58,columnNumber:13}},(0,_utils.formatChainInfoToShow)(item.chainId,currentNetwork))),_react.default.createElement(_reactNative.View,{style:itemStyle.balanceWrap,__self:_this,__source:{fileName:_jsxFileName,lineNumber:63,columnNumber:11}},_react.default.createElement(_CommonText.TextL,{style:[itemStyle.token,_styles.FontStyles.font5],__self:_this,__source:{fileName:_jsxFileName,lineNumber:64,columnNumber:13}},item==null?void 0:(_item$nftInfo2=item.nftInfo)==null?void 0:_item$nftInfo2.balance),_react.default.createElement(_CommonText.TextS,{style:itemStyle.dollar,__self:_this,__source:{fileName:_jsxFileName,lineNumber:65,columnNumber:13}}))));}return null;};var MAX_RESULT_COUNT=10;var INIT_PAGE_INFO={curPage:0,total:0,isLoading:false};var AssetList=function AssetList(){var _useLanguage=(0,_hooks.useLanguage)(),t=_useLanguage.t;var caAddresses=(0,_wallet.useCaAddresses)();var caAddressInfos=(0,_wallet.useCaAddressInfoList)();var _useState=(0,_react.useState)(''),_useState2=(0,_slicedToArray2.default)(_useState,2),keyword=_useState2[0],setKeyword=_useState2[1];var gStyles=(0,_useGStyles.useGStyles)();var debounceKeyword=(0,_useDebounce.default)(keyword,800);var _useGetCurrentAccount=(0,_useTokensPrice.useGetCurrentAccountTokenPrice)(),_useGetCurrentAccount2=(0,_slicedToArray2.default)(_useGetCurrentAccount,2),getTokenPrice=_useGetCurrentAccount2[1];var _useState3=(0,_react.useState)([]),_useState4=(0,_slicedToArray2.default)(_useState3,2),listShow=_useState4[0],setListShow=_useState4[1];var pageInfoRef=(0,_react.useRef)(Object.assign({},INIT_PAGE_INFO));var getList=(0,_react.useCallback)((0,_asyncToGenerator2.default)(function*(){var _keyword=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'';var isInit=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(!isInit&&listShow.length>0&&listShow.length>=pageInfoRef.current.total)return;if(pageInfoRef.current.isLoading)return;pageInfoRef.current.isLoading=true;try{var response=yield(0,_api.fetchAssetList)({caAddressInfos:caAddressInfos,caAddresses:caAddresses,maxResultCount:MAX_RESULT_COUNT,skipCount:pageInfoRef.current.curPage*MAX_RESULT_COUNT,keyword:_keyword});pageInfoRef.current.curPage=pageInfoRef.current.curPage+1;pageInfoRef.current.total=response.totalRecordCount;console.log('fetchAccountAssetsByKeywords:',response);if(isInit){setListShow(response.data);}else{setListShow(function(pre){return pre.concat(response.data);});}}catch(err){console.log('fetchAccountAssetsByKeywords err:',err);}pageInfoRef.current.isLoading=false;}),[caAddressInfos,caAddresses,listShow.length]);var onKeywordChange=(0,_react.useCallback)(function(){pageInfoRef.current=Object.assign({},INIT_PAGE_INFO);getList(debounceKeyword,true);},[getList,debounceKeyword]);(0,_react.useEffect)(function(){onKeywordChange();},[debounceKeyword]);(0,_useEffectOnce.default)(function(){getTokenPrice();});var renderItem=(0,_react.useCallback)(function(_ref2){var item=_ref2.item;return _react.default.createElement(AssetItem,{symbol:item.symbol||'',item:item,onPress:function onPress(){_OverlayModal.default.hide();var routeParams={sendType:item!=null&&item.nftInfo?'nft':'token',assetInfo:item!=null&&item.nftInfo?Object.assign({},item==null?void 0:item.nftInfo,{chainId:item.chainId,symbol:item.symbol}):Object.assign({},item==null?void 0:item.tokenInfo,{chainId:item.chainId,symbol:item.symbol}),toInfo:{address:'',name:''}};_navigationService.default.navigate('SendHome',routeParams);},__self:_this,__source:{fileName:_jsxFileName,lineNumber:144,columnNumber:7}});},[]);var noData=(0,_react.useMemo)(function(){return debounceKeyword?_react.default.createElement(_NoData.default,{noPic:true,message:t('No results found'),__self:_this,__source:{fileName:_jsxFileName,lineNumber:168,columnNumber:7}}):_react.default.createElement(_NoData.default,{noPic:true,message:t('There are currently no assets to send.'),__self:_this,__source:{fileName:_jsxFileName,lineNumber:170,columnNumber:7}});},[debounceKeyword,t]);return _react.default.createElement(_ModalBody.ModalBody,{modalBodyType:"bottom",title:t('Select Assets'),style:gStyles.overlayStyle,__self:_this,__source:{fileName:_jsxFileName,lineNumber:174,columnNumber:5}},_react.default.createElement(_CommonInput.default,{placeholder:t('Search Assets'),containerStyle:styles.containerStyle,inputContainerStyle:styles.inputContainerStyle,inputStyle:styles.inputStyle,value:keyword,onChangeText:function onChangeText(v){setKeyword(v.trim());},__self:_this,__source:{fileName:_jsxFileName,lineNumber:176,columnNumber:7}}),_react.default.createElement(_reactNative.FlatList,{disableScrollViewPanResponder:true,onLayout:function onLayout(e){_deviceEvent.default.nestScrollViewLayout.emit(e.nativeEvent.layout);},onScroll:function onScroll(_ref3){var nativeEvent=_ref3.nativeEvent;var scrollY=nativeEvent.contentOffset.y;if(scrollY<=0){_deviceEvent.default.nestScrollViewScrolledTop.emit();}},style:styles.flatList,data:listShow||[],renderItem:renderItem,keyExtractor:function keyExtractor(_item,index){return""+index;},ListEmptyComponent:noData,onEndReached:function onEndReached(){getList();},__self:_this,__source:{fileName:_jsxFileName,lineNumber:186,columnNumber:7}}));};var showAssetList=exports.showAssetList=function showAssetList(){_OverlayModal.default.show(_react.default.createElement(AssetList,{__self:_this,__source:{fileName:_jsxFileName,lineNumber:213,columnNumber:21}}),{position:'bottom',autoKeyboardInsets:false,enabledNestScrollView:true});};var _default=exports.default={showAssetList:showAssetList};var styles=exports.styles=_reactNative.StyleSheet.create({title:{textAlign:'center',height:(0,_unit.pTd)(22),lineHeight:(0,_unit.pTd)(22),marginTop:(0,_unit.pTd)(17),marginBottom:(0,_unit.pTd)(16),fontSize:(0,_unit.pTd)(20)},containerStyle:{marginLeft:(0,_unit.pTd)(16),width:(0,_unit.pTd)(343),marginBottom:(0,_unit.pTd)(8)},inputContainerStyle:{height:(0,_unit.pTd)(44)},inputStyle:{height:(0,_unit.pTd)(44)},flatList:{marginTop:(0,_unit.pTd)(8)}});var itemStyle=_reactNative.StyleSheet.create({wrap:{height:(0,_unit.pTd)(72),display:'flex',flexDirection:'row',justifyContent:'space-between',alignItems:'center'},left:{marginLeft:(0,_unit.pTd)(16),width:(0,_unit.pTd)(48),height:(0,_unit.pTd)(48),borderRadius:(0,_unit.pTd)(6),overflow:'hidden'},noPic:{backgroundColor:_theme.defaultColors.bg7,color:_theme.defaultColors.font7,fontSize:(0,_unit.pTd)(20),textAlign:'center',lineHeight:(0,_unit.pTd)(48)},right:{height:(0,_unit.pTd)(72),marginLeft:(0,_unit.pTd)(16),paddingRight:(0,_unit.pTd)(16),flex:1,display:'flex',flexDirection:'row',justifyContent:'space-between',alignItems:'center',borderBottomColor:_theme.defaultColors.bg7,borderBottomWidth:_reactNative.StyleSheet.hairlineWidth},tokenName:{flex:1},balanceWrap:{flex:1,display:'flex',flexDirection:'column',justifyContent:'center',alignItems:'flex-end'},token:{lineHeight:(0,_unit.pTd)(22),overflow:'hidden'},dollar:{marginTop:(0,_unit.pTd)(2),lineHeight:(0,_unit.pTd)(16)},nftItemInfo:{marginTop:(0,_unit.pTd)(2)}});