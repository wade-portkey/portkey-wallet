var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.checkSiteIsInBlackList=checkSiteIsInBlackList;exports.formatExpiredTime=formatExpiredTime;exports.formatSession=formatSession;exports.formatTimeToStr=formatTimeToStr;exports.hasSessionInfoExpired=hasSessionInfoExpired;exports.signSession=signSession;exports.verifySession=verifySession;var _session=require("../types/session");var _aelfSdk=_interopRequireDefault(require("aelf-sdk"));var _dayjs=_interopRequireDefault(require("dayjs"));var HOUR=60*60*1000;function formatSession(_ref){var origin=_ref.origin,managerAddress=_ref.managerAddress,caHash=_ref.caHash,expiredPlan=_ref.expiredPlan,expiredTime=_ref.expiredTime;var msg=JSON.stringify({origin:origin,managerAddress:managerAddress,caHash:caHash,expiredPlan:expiredPlan,expiredTime:expiredTime});return _aelfSdk.default.utils.sha256(msg);}function signSession(params){var signOptions=params.keyPair.sign(formatSession(params));return Buffer.from(signOptions.toDER()).toString('hex');}function verifySession(params){return params.keyPair.verify(formatSession(params),params.signature);}function hasSessionInfoExpired(sessionInfo){if(sessionInfo.expiredPlan===_session.SessionExpiredPlan.always)return false;if(Date.now()<sessionInfo.expiredTime)return false;return true;}function formatExpiredTime(plan){if(typeof plan==='number'){return Date.now()+plan*HOUR;}else{return Date.now();}}function formatTimeToStr(time){if(time===undefined||time===null)return'--';return(0,_dayjs.default)(time).format('YYYY-MM-DD HH:mm:ss');}function checkSiteIsInBlackList(blackList,origin){if(blackList.includes(origin)||blackList.includes('**'))return true;return false;}