var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.guardiansSlice=void 0;var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _verifier=require("../../../types/verifier");var _toolkit=require("@reduxjs/toolkit");var _moment=_interopRequireDefault(require("moment"));var _actions=require("./actions");var _wallet=require("../../../types/types-ca/wallet");var _misc=require("../../../constants/misc");var initialState={};var guardiansSlice=exports.guardiansSlice=(0,_toolkit.createSlice)({name:'guardians',initialState:initialState,reducers:{},extraReducers:function extraReducers(builder){builder.addCase(_actions.resetGuardiansState,function(){return initialState;}).addCase(_actions.resetGuardians,function(state){return Object.assign({},initialState,{verifierMap:state.verifierMap});}).addCase(_actions.setVerifierListAction,function(state,action){if(!action.payload){state.verifierMap={};return;}var map={};action.payload.forEach(function(item){map[item.id]=item;});state.verifierMap=map;}).addCase(_actions.setGuardiansAction,function(state,action){var _state$userGuardianSt;var verifierMap=state.verifierMap;if(!action.payload){state.userGuardiansList=[];state.userGuardianStatus={};return;}var guardianList=action.payload.guardianList;var userStatus=(_state$userGuardianSt=state.userGuardianStatus)!=null?_state$userGuardianSt:{};var _guardianList=guardianList.guardians.map(function(item){var _userStatus$key;var key=item.guardianIdentifier+"&"+item.verifierId;var _guardian=Object.assign({},item,{guardianAccount:item.guardianIdentifier||item.identifierHash,guardianType:_wallet.LoginType[item.type],key:key,verifier:verifierMap==null?void 0:verifierMap[item.verifierId],isLoginAccount:item.isLoginGuardian});userStatus[key]=Object.assign({},_guardian,{status:userStatus==null?void 0:(_userStatus$key=userStatus[key])==null?void 0:_userStatus$key.status});return _guardian;});state.userGuardiansList=_guardianList;state.userGuardianStatus=userStatus;state.guardianExpiredTime=undefined;}).addCase(_actions.setPreGuardianAction,function(state,action){if(!action.payload){state.preGuardian=undefined;}else{var _state$userGuardianSt2;state.preGuardian=Object.assign({},(_state$userGuardianSt2=state.userGuardianStatus)==null?void 0:_state$userGuardianSt2[action.payload.key],action.payload);}}).addCase(_actions.setOpGuardianAction,function(state,action){if(!action.payload){state.opGuardian=undefined;}else{var _state$userGuardianSt3;state.opGuardian=Object.assign({},(_state$userGuardianSt3=state.userGuardianStatus)==null?void 0:_state$userGuardianSt3[action.payload.key],action.payload);}}).addCase(_actions.setCurrentGuardianAction,function(state,action){var _state$userGuardianSt4;state.currentGuardian=Object.assign({},(_state$userGuardianSt4=state.userGuardianStatus)==null?void 0:_state$userGuardianSt4[action.payload.key],action.payload);state.userGuardianStatus=Object.assign({},state.userGuardianStatus,(0,_defineProperty2.default)({},action.payload.key,state.currentGuardian));}).addCase(_actions.setUserGuardianStatus,function(state,action){var userStatus=action.payload;state.userGuardianStatus=userStatus;}).addCase(_actions.setUserGuardianItemStatus,function(state,action){var _state$userGuardianSt5;var _action$payload=action.payload,key=_action$payload.key,status=_action$payload.status,signature=_action$payload.signature,verificationDoc=_action$payload.verificationDoc,identifierHash=_action$payload.identifierHash;if(!((_state$userGuardianSt5=state.userGuardianStatus)!=null&&_state$userGuardianSt5[key]))throw Error("Can't find this item");state.userGuardianStatus[key]['status']=status;state.userGuardianStatus[key]['signature']=signature;state.userGuardianStatus[key]['verificationDoc']=verificationDoc;state.userGuardianStatus[key]['identifierHash']=identifierHash||'';if(!state.guardianExpiredTime&&status===_verifier.VerifyStatus.Verified){state.guardianExpiredTime=(0,_moment.default)().add(_misc.GUARDIAN_EXPIRED_TIME,'ms').valueOf();}}).addCase(_actions.resetUserGuardianStatus,function(state){state.userGuardianStatus={};}).addCase(_actions.setUserGuardianSessionIdAction,function(state,action){var _state$userGuardianSt6,_state$currentGuardia;var _action$payload2=action.payload,key=_action$payload2.key,verifierInfo=_action$payload2.verifierInfo;if(!((_state$userGuardianSt6=state.userGuardianStatus)!=null&&_state$userGuardianSt6[key]))throw Error("Can't find this item");state.userGuardianStatus[key]['verifierInfo']=verifierInfo;if(((_state$currentGuardia=state.currentGuardian)==null?void 0:_state$currentGuardia.key)===key)state.currentGuardian['verifierInfo']=verifierInfo;});}});