var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=void 0;var _react=require("react");var _reactNative=require("react-native");var _nativeModules=require("../../service/native-modules");var _BaseContainerContext=_interopRequireDefault(require("./BaseContainerContext"));var _entries=require("../../global/init/entries");var useBaseContainer=function useBaseContainer(props){var onShowListener=(0,_react.useRef)(null);var onNewIntentListener=(0,_react.useRef)(null);var baseContainerContext=(0,_react.useContext)(_BaseContainerContext.default);var containerId=props.containerId,entryName=props.entryName,onShow=props.onShow,onNewIntent=props.onNewIntent;(0,_react.useEffect)(function(){if(containerId){var _onShowListener$curre;(_onShowListener$curre=onShowListener.current)==null?void 0:_onShowListener$curre.remove();onShowListener.current=_nativeModules.PortkeyDeviceEventEmitter.addListener('onShow',function(params){var _ref=params||{},nativeContainerId=_ref.containerId;if(containerId===nativeContainerId){onShow==null?void 0:onShow();}});}if(onNewIntent){var _onNewIntentListener$;(_onNewIntentListener$=onNewIntentListener.current)==null?void 0:_onNewIntentListener$.remove();onNewIntentListener.current=_reactNative.DeviceEventEmitter.addListener('onNewIntent',function(params){onNewIntent==null?void 0:onNewIntent(params);});}return function(){var _onShowListener$curre2,_onNewIntentListener$2;(_onShowListener$curre2=onShowListener.current)==null?void 0:_onShowListener$curre2.remove();(_onNewIntentListener$2=onNewIntentListener.current)==null?void 0:_onNewIntentListener$2.remove();};},[onShow,containerId,onNewIntent]);var getEntryName=(0,_react.useCallback)(function(){return entryName!=null?entryName:baseContainerContext.entryName;},[entryName,baseContainerContext.entryName]);var navigateTo=(0,_react.useCallback)(function(entry,_ref2){var _ref2$params=_ref2.params,params=_ref2$params===void 0?{}:_ref2$params,_ref2$targetScene=_ref2.targetScene,targetScene=_ref2$targetScene===void 0?'none':_ref2$targetScene,_ref2$closeCurrentScr=_ref2.closeCurrentScreen,closeCurrentScreen=_ref2$closeCurrentScr===void 0?false:_ref2$closeCurrentScr;_nativeModules.PortkeyModulesEntity.RouterModule.navigateTo(entry,_entries.LaunchModeSet.get(entry)||_entries.LaunchMode.STANDARD,getEntryName(),targetScene!=null?targetScene:'none',closeCurrentScreen!=null?closeCurrentScreen:false,params);},[getEntryName]);var navigateForResult=(0,_react.useCallback)(function(entry,options){var callback=arguments.length>2&&arguments[2]!==undefined?arguments[2]:function(){};var params=options.params,closeCurrentScreen=options.closeCurrentScreen,navigationAnimation=options.navigationAnimation,navigationAnimationDuration=options.navigationAnimationDuration,targetScene=options.targetScene;_nativeModules.PortkeyModulesEntity.RouterModule.navigateToWithOptions(entry,_entries.LaunchModeSet.get(entry)||_entries.LaunchMode.STANDARD,getEntryName(),{params:params!=null?params:{},closeCurrentScreen:closeCurrentScreen!=null?closeCurrentScreen:false,navigationAnimation:navigationAnimation!=null?navigationAnimation:'slide',navigationAnimationDuration:navigationAnimationDuration!=null?navigationAnimationDuration:2000,targetScene:targetScene!=null?targetScene:''},callback);},[getEntryName]);var onFinish=(0,_react.useCallback)(function(res){_nativeModules.PortkeyModulesEntity.RouterModule.navigateBack(res);},[]);var onError=(0,_react.useCallback)(function(err){_nativeModules.PortkeyModulesEntity.NativeWrapperModule.onError(getEntryName(),err.message,{stack:err.stack});},[getEntryName]);var onFatal=(0,_react.useCallback)(function(err){_nativeModules.PortkeyModulesEntity.NativeWrapperModule.onFatalError(getEntryName(),err.message,{stack:err.stack});},[getEntryName]);var onWarn=(0,_react.useCallback)(function(msg){_nativeModules.PortkeyModulesEntity.NativeWrapperModule.onWarning(getEntryName(),msg);},[getEntryName]);return(0,_react.useMemo)(function(){return{getEntryName:getEntryName,navigateTo:navigateTo,navigateForResult:navigateForResult,onFinish:onFinish,onError:onError,onFatal:onFatal,onWarn:onWarn};},[getEntryName,navigateForResult,navigateTo,onError,onFatal,onFinish,onWarn]);};var _default=exports.default=useBaseContainer;