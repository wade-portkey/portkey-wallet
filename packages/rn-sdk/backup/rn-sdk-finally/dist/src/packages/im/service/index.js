var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.IMService=void 0;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _inherits2=_interopRequireDefault(require("@babel/runtime/helpers/inherits"));var _possibleConstructorReturn2=_interopRequireDefault(require("@babel/runtime/helpers/possibleConstructorReturn"));var _getPrototypeOf2=_interopRequireDefault(require("@babel/runtime/helpers/getPrototypeOf"));var _services=require("@portkey/services");var _utils=require("../../utils");function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function _createSuperInternal(){var Super=(0,_getPrototypeOf2.default)(Derived),result;if(hasNativeReflectConstruct){var NewTarget=(0,_getPrototypeOf2.default)(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return(0,_possibleConstructorReturn2.default)(this,result);};}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}));return true;}catch(e){return false;}}var IMService=exports.IMService=function(_BaseService){(0,_inherits2.default)(IMService,_BaseService);var _super=_createSuper(IMService);function IMService(request){(0,_classCallCheck2.default)(this,IMService);return _super.call(this,request);}(0,_createClass2.default)(IMService,[{key:"verifySignature",value:function verifySignature(params){return this._request.send({url:'/api/v1/users/token',params:params,method:'POST',headers:{'R-Authorization':''}});}},{key:"verifySignatureLoop",value:function(){var _verifySignatureLoop=(0,_asyncToGenerator2.default)(function*(generateVerifyData,checkIsContinue){var times=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;try{var params=generateVerifyData();if(params===null)throw new Error('VerifyData is null');return yield this.verifySignature(params);}catch(error){var isContinue=checkIsContinue();if(!isContinue)throw new Error('account changed');if(times===1)throw error;console.log('verifySignatureLoop: error',error);}if(times<=0)yield(0,_utils.sleep)(1000);return this.verifySignatureLoop(generateVerifyData,checkIsContinue,times-1);});function verifySignatureLoop(_x,_x2){return _verifySignatureLoop.apply(this,arguments);}return verifySignatureLoop;}()},{key:"getAuthToken",value:function getAuthToken(params){return this._request.send({url:'/api/v1/users/auth',params:params,method:'POST',headers:{'R-Authorization':''}});}},{key:"getAuthTokenLoop",value:function(){var _getAuthTokenLoop=(0,_asyncToGenerator2.default)(function*(params,checkIsContinue){var times=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;try{return yield this.getAuthToken(params);}catch(error){var isContinue=checkIsContinue();if(!isContinue)throw new Error('account changed');if(times===1)throw error;console.log('getAuthToken: error',error);}if(times<=0)yield(0,_utils.sleep)(1000);return this.getAuthTokenLoop(params,checkIsContinue,times-1);});function getAuthTokenLoop(_x3,_x4){return _getAuthTokenLoop.apply(this,arguments);}return getAuthTokenLoop;}()},{key:"getUserInfo",value:function getUserInfo(params){return this._request.send({url:'/api/v1/users/userInfo',params:params,method:'GET'});}},{key:"createChannel",value:function createChannel(params){return this._request.send({url:'/api/v1/channelContacts/createChannel',params:params,method:'POST'});}},{key:"getChannelInfo",value:function getChannelInfo(params){return this._request.send({url:'/api/v1/channelContacts/channelDetailInfo',params:params,method:'GET'});}},{key:"getChannelMembers",value:function getChannelMembers(params){return this._request.send({url:'/api/v1/channelContacts/members',params:params,method:'GET'});}},{key:"sendMessage",value:function sendMessage(params){return this._request.send({url:'/api/v1/message/send',params:params,method:'POST'});}},{key:"readMessage",value:function readMessage(params){return this._request.send({url:'/api/v1/message/read',params:params,method:'POST'});}},{key:"getMessageList",value:function getMessageList(params){return this._request.send({url:'/api/v1/message/list',params:params,method:'GET'});}},{key:"deleteMessage",value:function deleteMessage(params){return this._request.send({url:'/api/v1/message/hide',params:params,method:'POST'});}},{key:"getUnreadCount",value:function getUnreadCount(){return this._request.send({url:'/api/v1/message/unreadCount',method:'GET'});}},{key:"triggerMessageEvent",value:function triggerMessageEvent(params){return this._request.send({url:'/api/v1/message/event',params:params,method:'POST'});}},{key:"getChannelList",value:function getChannelList(params){return this._request.send({url:'/api/v1/feed/list',params:params,method:'GET'});}},{key:"updateChannelPin",value:function updateChannelPin(params){return this._request.send({url:'/api/v1/feed/pin',params:params,method:'POST'});}},{key:"updateChannelMute",value:function updateChannelMute(params){return this._request.send({url:'/api/v1/feed/mute',params:params,method:'POST'});}},{key:"hideChannel",value:function hideChannel(params){return this._request.send({url:'/api/v1/feed/hide',params:params,method:'POST'});}},{key:"addStranger",value:function addStranger(params){return this._request.send({url:'/api/v1/contacts/stranger',params:params,method:'POST'});}},{key:"getProfile",value:function getProfile(params){return this._request.send({url:'/api/v1/contacts/profile',params:params,method:'GET'});}}]);return IMService;}(_services.BaseService);