var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");Object.defineProperty(exports,"__esModule",{value:true});exports.default=Referral;var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));var _react=_interopRequireWildcard(require("react"));var _reactNative=require("react-native");var _styles=require("../../../assets/theme/styles");var _styles2=_interopRequireDefault(require("../styles"));var _Touchable=_interopRequireDefault(require("../../../components/Touchable"));var _GStyles=_interopRequireDefault(require("../../../assets/theme/GStyles"));var _CommonText=require("../../../components/CommonText");var _Svg=_interopRequireDefault(require("../../../components/Svg"));var _unit=require("../../../utils/unit");var _CommonButton=_interopRequireDefault(require("../../../components/CommonButton"));var _entries=require("../../../config/entries");var _UseBaseContainer=_interopRequireDefault(require("../../../model/container/UseBaseContainer"));var _core=require("../../../model/verify/core");var _CommonToast=_interopRequireDefault(require("../../../components/CommonToast"));var _useEffectOnce=_interopRequireDefault(require("../../../hooks/useEffectOnce"));var _TermsServiceButton=_interopRequireDefault(require("./TermsServiceButton"));var _Divider=_interopRequireDefault(require("../../../components/Divider"));var _theme=require("../../../assets/theme");var _types=require("../types");var _entry=require("../../../model/verify/entry");var _device=require("../../../packages/utils/mobile/device");var _handler=require("../../../model/contract/handler");var _Loading=_interopRequireDefault(require("../../../components/Loading"));var _wallet=require("../../../model/wallet");var _jsxFileName="/Users/fengfeiyang/aelf/portkey-wallet/packages/rn-sdk/android/rn-sdk-finally/src/pages/Login/components/Referral.tsx";function _getRequireWildcardCache(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap(),t=new WeakMap();return(_getRequireWildcardCache=function _getRequireWildcardCache(e){return e?t:r;})(e);}function _interopRequireWildcard(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=_getRequireWildcardCache(r);if(t&&t.has(e))return t.get(e);var n={__proto__:null},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var u in e)if("default"!==u&&Object.prototype.hasOwnProperty.call(e,u)){var i=a?Object.getOwnPropertyDescriptor(e,u):null;i&&(i.get||i.set)?Object.defineProperty(n,u,i):n[u]=e[u];}return n.default=e,t&&t.set(e,n),n;}var TitleMap=(0,_defineProperty2.default)((0,_defineProperty2.default)({},_types.PageType.login,{apple:'Login with Apple',google:'Login with Google',button:'Login with Phone / Email'}),_types.PageType.signup,{apple:'Signup with Apple',google:'Signup with Google',button:'Signup with Phone / Email'});function Referral(_ref){var setLoginType=_ref.setLoginType,_ref$type=_ref.type,type=_ref$type===void 0?_types.PageType.login:_ref$type;var _useBaseContainer=(0,_UseBaseContainer.default)({entryName:_entries.PortkeyEntries.SIGN_IN_ENTRY}),onFinish=_useBaseContainer.onFinish,navigateForResult=_useBaseContainer.navigateForResult,getEntryName=_useBaseContainer.getEntryName;var setErrorMessage=function setErrorMessage(msg){if(msg){_CommonToast.default.failError(msg);}};var _useVerifyEntry=(0,_entry.useVerifyEntry)({type:type,accountOriginalType:_core.AccountOriginalType.Apple,entryName:getEntryName(),setErrorMessage:setErrorMessage}),thirdPartyLogin=_useVerifyEntry.thirdPartyLogin;var onSuccess=function(){var _ref2=(0,_asyncToGenerator2.default)(function*(){var text=arguments.length>0&&arguments[0]!==undefined?arguments[0]:'sign in / sign up success';var walletInfo=yield(0,_wallet.getUnlockedWallet)();onFinish({status:'success',data:{finished:true,msg:text,walletInfo:walletInfo}});});return function onSuccess(){return _ref2.apply(this,arguments);};}();var pushToSignUp=function pushToSignUp(){navigateForResult(_entries.PortkeyEntries.SIGN_UP_ENTRY,{},function(res){if(res.status==='success'){onSuccess();}});};(0,_useEffectOnce.default)((0,_asyncToGenerator2.default)(function*(){walletCheck();_Loading.default.show();try{yield(0,_handler.getOrReadCachedVerifierData)();}catch(_){}_Loading.default.hide();}));var walletCheck=function(){var _ref4=(0,_asyncToGenerator2.default)(function*(){if(yield(0,_core.isWalletExists)()){if(yield(0,_core.isWalletUnlocked)()){onSuccess('you have already signed in');}else{var tryToUnlock=function(){var _ref5=(0,_asyncToGenerator2.default)(function*(){navigateForResult(_entries.PortkeyEntries.CHECK_PIN,{},function(res){if(res.status==='success'){onSuccess('wallet unlock success');}else{onFinish({status:'cancel',data:{finished:false,msg:'unlock cancelled'}});}});});return function tryToUnlock(){return _ref5.apply(this,arguments);};}();tryToUnlock();}}});return function walletCheck(){return _ref4.apply(this,arguments);};}();var onGoogleSign=(0,_react.useCallback)(function(){thirdPartyLogin('google');},[thirdPartyLogin]);var onAppleSign=(0,_react.useCallback)(function(){thirdPartyLogin('apple');},[thirdPartyLogin]);var qrcodeImage=(0,_react.useMemo)(function(){if(_device.isIOS){return{uri:'QR-code'};}else{return require("../../../assets/image/pngs/QR-code.png");}},[]);return _react.default.createElement(_reactNative.View,{style:[_styles.BGStyles.bg1,_styles2.default.card,_GStyles.default.itemCenter,_GStyles.default.spaceBetween],__self:this,__source:{fileName:_jsxFileName,lineNumber:135,columnNumber:5}},type===_types.PageType.login&&_react.default.createElement(_Touchable.default,{style:_styles2.default.iconBox,onPress:function onPress(){return setLoginType(_types.PageLoginType.qrCode);},__self:this,__source:{fileName:_jsxFileName,lineNumber:137,columnNumber:9}},_react.default.createElement(_reactNative.Image,{source:qrcodeImage,style:_styles2.default.iconStyle,__self:this,__source:{fileName:_jsxFileName,lineNumber:138,columnNumber:11}})),_react.default.createElement(_reactNative.View,{style:_GStyles.default.width100,__self:this,__source:{fileName:_jsxFileName,lineNumber:141,columnNumber:7}},_react.default.createElement(_CommonButton.default,{type:"outline",onPress:onGoogleSign,title:TitleMap[type].google,icon:_react.default.createElement(_Svg.default,{icon:"google",size:24,__self:this,__source:{fileName:_jsxFileName,lineNumber:146,columnNumber:17}}),containerStyle:pageStyles.outlineContainerStyle,titleStyle:[_styles.FontStyles.font3,pageStyles.outlineTitleStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:142,columnNumber:9}}),_react.default.createElement(_CommonButton.default,{type:"outline",onPress:onAppleSign,title:TitleMap[type].apple,icon:_react.default.createElement(_Svg.default,{icon:"apple",size:24,__self:this,__source:{fileName:_jsxFileName,lineNumber:155,columnNumber:17}}),containerStyle:pageStyles.outlineContainerStyle,titleStyle:[_styles.FontStyles.font3,pageStyles.outlineTitleStyle],__self:this,__source:{fileName:_jsxFileName,lineNumber:151,columnNumber:9}}),_react.default.createElement(_Divider.default,{title:"OR",inset:true,style:pageStyles.dividerStyle,__self:this,__source:{fileName:_jsxFileName,lineNumber:160,columnNumber:9}}),_react.default.createElement(_CommonButton.default,{type:"primary",onPress:function onPress(){return setLoginType(_types.PageLoginType.phone);},title:TitleMap[type].button,__self:this,__source:{fileName:_jsxFileName,lineNumber:161,columnNumber:9}})),type===_types.PageType.login&&_react.default.createElement(_Touchable.default,{style:[_GStyles.default.flexRowWrap,_GStyles.default.itemCenter,_styles2.default.signUpTip],onPress:pushToSignUp,__self:this,__source:{fileName:_jsxFileName,lineNumber:164,columnNumber:9}},_react.default.createElement(_CommonText.TextL,{style:_styles.FontStyles.font3,__self:this,__source:{fileName:_jsxFileName,lineNumber:165,columnNumber:11}},"No account? ",_react.default.createElement(_reactNative.Text,{style:_styles.FontStyles.font4,__self:this,__source:{fileName:_jsxFileName,lineNumber:166,columnNumber:25}},"Sign up ")),_react.default.createElement(_Svg.default,{size:(0,_unit.pTd)(20),color:_styles.FontStyles.font4.color,icon:"right-arrow2",__self:this,__source:{fileName:_jsxFileName,lineNumber:168,columnNumber:11}})),_react.default.createElement(_TermsServiceButton.default,{__self:this,__source:{fileName:_jsxFileName,lineNumber:171,columnNumber:7}}));}var pageStyles=_reactNative.StyleSheet.create({outlineContainerStyle:{marginTop:20,borderWidth:_reactNative.StyleSheet.hairlineWidth,borderColor:_theme.defaultColors.border1},outlineTitleStyle:{marginLeft:12},dividerStyle:{marginVertical:16},skeleton:{height:'100%',width:'100%'}});